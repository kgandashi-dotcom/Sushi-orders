<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>תפריט סושי</title>
<style>
:root {
  --accent: #7a2a2a;
  --accent-dark: #5e1b1b;
  --bg: #fff;
  --muted: #f0f0f0;
  --danger: #d9534f;
}

body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: linear-gradient(180deg,#f6f5f4, #efecec);
  color: #222;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 16px;
  flex-wrap: wrap;
}

#logo {
  margin: 0 auto;
  display: block;
  max-width: 150px;
}

.user-actions {
  display: flex;
  gap: 8px;
  align-items: center;
  order: -1;
}

.btn {
  padding: 8px 12px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 700;
}

.btn.primary {
  background: var(--accent);
  color: #fff;
}

.btn.secondary {
  background: #fff;
  color: var(--accent);
  border: 1px solid #ddd;
}

.menu-tabs {
  display: flex;
  gap: 8px;
  margin-top: 12px;
  overflow-x: auto;
}

.tab {
  padding: 8px 12px;
  border-radius: 8px;
  background: #fff;
  border: 1px solid #eee;
  cursor: pointer;
  font-weight: 700;
  white-space: nowrap;
}

.tab.active {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent-dark);
}

main {
  display: flex;
  gap: 18px;
  flex-wrap: wrap;
  padding: 16px;
}

#menu-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.category-container {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 6px 0;
}

.roll-card {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  border-radius: 10px;
  background: var(--bg);
  box-shadow: 0 4px 14px rgba(0,0,0,0.05);
}

.roll-card .info h3 {
  margin: 0;
  color: var(--accent);
  font-size: 1rem;
}

.roll-card .info p {
  margin: 0;
  font-size: 0.9rem;
}

.quantity-control {
  display: flex;
  align-items: center;
  gap: 8px;
}

.quantity-control button {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  border: none;
  background: #f0c0c0;
  color: var(--accent);
  font-weight: 700;
  font-size: 1.2rem;
  cursor: pointer;
}

.quantity-control input {
  width: 50px;
  text-align: center;
  border: 1px solid #ddd;
  padding: 6px;
  border-radius: 6px;
}

#side-area {
  width: 360px;
  flex-shrink: 0;
}

.panel {
  background: #fff;
  padding: 12px;
  border-radius: 10px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.04);
  margin-bottom: 12px;
}

.panel-title {
  font-weight: 800;
  color: var(--accent);
  margin-bottom: 8px;
}

#order-summary {
  background: #fafafa;
  padding: 10px;
  border-radius: 8px;
  min-height: 150px;
  white-space: pre-wrap;
  font-family: "Courier New", monospace;
}

textarea {
  width: 100%;
  min-height: 80px;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ddd;
  resize: vertical;
}

.note {
  color: #6b6b6b;
  font-size: 0.9rem;
  margin-top: 8px;
}

#messages {
  margin-top: 8px;
  color: var(--danger);
  font-weight: 700;
}

/* responsive */
@media(max-width: 980px){
  main {
    flex-direction: column;
  }
  #side-area {
    width: 100%;
  }
  .menu-tabs {
    flex-wrap: nowrap;
    overflow-x: auto;
  }
}
</style>
</head>
<body>
<header>
  <div class="user-actions">
    <button id="profile-btn" class="btn secondary">התחבר</button>
  </div>
  <img id="logo" src="logo.png" alt="לוגו">
</header>
<nav class="menu-tabs">
  <button class="tab active" data-target="insideout-rolls">Inside-out</button>
  <button class="tab" data-target="maki-rolls">Maki</button>
  <button class="tab" data-target="onigiri-rolls">Onigiri</button>
  <button class="tab" data-target="poke-rolls">Poke</button>
  <button class="tab" data-target="oshizushi-rolls">Oshizushi</button>
</nav>
<main>
  <section id="menu-area">
    <div id="insideout-rolls" class="category-container"></div>
    <div id="maki-rolls" class="category-container" style="display:none;"></div>
    <div id="onigiri-rolls" class="category-container" style="display:none;"></div>
    <div id="poke-rolls" class="category-container" style="display:none;"></div>
    <div id="oshizushi-rolls" class="category-container" style="display:none;"></div>
  </section>
  <aside id="side-area">
    <section id="sauces-section" class="panel">
      <div class="panel-title">רטבים</div>
      <div id="sauces-container" class="category-container"></div>
      <p class="note">כל רול מקבל 2 רטבים חינם. רוטב נוסף 3₪.</p>
    </section>

    <section class="panel">
      <div class="panel-title">כמות צ'ופסטיקס</div>
      <div class="quantity-control">
        <button id="chopsticks-minus">−</button>
        <input id="chopsticks-qty" type="number" readonly value="1">
        <button id="chopsticks-plus">+</button>
      </div>
    </section>

    <section class="panel">
      <div class="panel-title">בחר שעת איסוף</div>
      <select id="pickup-time"><option value="">בחר שעה</option></select>
    </section>

    <section class="panel">
      <div class="panel-title">הערות אישיות</div>
      <textarea id="notes" placeholder="לדוגמה: ללא גלוטן, הגעה בשער 3..."></textarea>
    </section>

    <section class="panel">
      <div class="panel-title">סיכום הזמנה</div>
      <pre id="order-summary">הזמנה ריקה — בחר רולים, רטבים ושעה להצגת הסיכום.</pre>
      <div class="actions-row">
        <button id="send-order" class="btn primary" disabled>שלח הזמנה</button>
      </div>
    </section>
    <div id="messages" aria-live="polite"></div>
  </aside>
</main>

<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
<script>
// CONFIG
const SUPABASE_URL = 'https://oxjokdjwdvmmdtcvqvon.supabase.co';
const SUPABASE_KEY = 'YOUR_SUPABASE_KEY';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
const GOOGLE_CLIENT_ID = '962297663657-7bsrugivo5rjbu534lamiuc256gbqoc4.apps.googleusercontent.com';
const MAKE_WEBHOOK_URL = 'https://hook.eu2.make.com/asitqrbtyjum10ph3vf6gxhkd766us3r';

let bookedTimes = JSON.parse(localStorage.getItem('bookedTimes')||'[]');
let dailyRollCount = JSON.parse(localStorage.getItem('dailyRollCount')||'{}');
let currentUser = JSON.parse(localStorage.getItem('currentUser')||'null');
let chopsticksCount = 1;
let selectedRolls = {};
let selectedSauces = {};

// MENU DATA
const insideOutRollsData = [
{id:"bingo",name:"רול בינגו - 50₪",description:"סלמון נא, שמנת, אבוקדו בציפוי שומשום קלוי",price:50},
{id:"luna",name:"רול לונה - 50₪",description:"ספייסי סלמון אפוי על רול בטטה, אבוקדו ושיטאקי",price:50},
{id:"belgian",name:"רול ריי - 55₪",description:"טרטר ספייסי טונה נא על רול מלפפון, עירית ואושינקו",price:55},
{id:"crazy-bruno",name:"רול קרייזי ברונו - 60₪",description:"דג לבן, טונה, סלמון בציפוי שומשום קלוי",price:60},
{id:"happy-bruno",name:"רול האפי ברונו - 60₪",description:"סלמון בציפוי שקדים קלויים ורוטב טריאקי",price:60},
{id:"mila",name:"רול מילה - 50₪",description:"בטטה, עירית ואבוקדו בעיטוף סלמון צרוב",price:50},
{id:"newton",name:"רול ניוטון - 55₪",description:"טונה אדומה, אבוקדו, בטטה בציפוי פנקו ורוטב בוטנים",price:55},
{id:"oli",name:"רול אולי - 50₪",description:"דג לבן, מלפפון, אבוקדו בציפוי שומשום",price:50},
{id:"milli",name:"רול מילי - 50₪",description:"מקל סורימי, דג לבן אפוי, אושינקו בציפוי פנקו",price:50},
{id:"scar",name:"רול סקאר - 50₪",description:"ספייסי סלמון אפוי עם אבוקדו, מלפפון ובטטה בעיטור מיונז וצ’יפס",price:50},
{id:"magi",name:"רול מגי🌱 - 40₪",description:"מלפפון, בטטה, עירית ואבוקדו בעיטור בטטה ורוטב בוטנים",price:40},
{id:"tyson",name:"רול טייסון וקיילה - 50₪",description:"סלמון נא, קנפיו, בטטה בעיטוף שבבי פנקו סגול",price:50},
{id:"lucy",name:"רול לוסי - 55₪",description:"סלמון נא, פטריות שיטאקי ואושינקו בציפוי טוביקו",price:55},
{id:"billy",name:"רול בילי - 50₪",description:"דג לבן צרוב, עירית, בטטה מצופה בפנקו",price:50},
{id:"lucky",name:"רול לאקי - 50₪",description:"טרטר ספייסי סלמון עם אבוקדו, מלפפון ועירית",price:50}
];

const makiRollsData = [
{id:"alfi",name:"רול אלפי - 35₪",description:"מאקי סלמון",price:35},
{id:"maymay",name:"רול מיי מיי🌱 - 25₪",description:"מאקי בטטה ואבוקדו",price:25},
{id:"snoopy",name:"רול סנופי🌱 - 25₪",description:"מאקי אושינקו וקנפיו",price:25}
];

const onigiriData = [
{id:"rocky",name:"אוניגירי רוקי - 35₪",description:"טרטר טונה אדומה עם ספייסי מיונז ובצל ירוק",price:35},
{id:"johnny",name:"אוניגירי ג׳וני - 30₪",description:"טרטר סלמון עם ספייסי מיונז ובצל ירוק",price:30},
{id:"gisel",name:"אוניגירי ג׳יזל🌱 - 25₪",description:"אבוקדו ובטטה",price:25}
];

const pokeData = [
{id:"dog",name:"בול-דוג - 60₪",description:"אורז סושי, סלמון במרינדה, אדממה, מלפפון, אבוקדו, בצל ירוק. מעל שומשום ורוטב ספייסי מיונז",price:60},
{id:"pit",name:"פיט-בול - 70₪",description:"אורז סושי, טונה במרינדה, אדממה, מנגו, כרוב סגול, פטריות שיטאקי. מעל בצל שאלוט מטוגן ורוטב אננס מתוק",price:70},
{id:"trir",name:"בול-טרייר🌱 - 45₪",description:"אורז סושי, אדממה, מלפפון, פטריות שיטאקי, גזר ואבוקדו. מעל שומשום ורוטב בוטנים",price:45}
];

const oshizushiData = [
{id:"osh1",name:"אושיזושי סלמון - 55₪",description:"סלמון, אורז, ירקות",price:55},
{id:"osh2",name:"אושיזושי טונה - 60₪",description:"טונה אדומה, אורז, ירקות",price:60}
];

const saucesData = [
{id:"spicy-mayo",name:"ספייסי מיונז",price:3},
{id:"soy",name:"רוטב סויה",price:3},
{id:"teriyaki",name:"רוטב טריאקי",price:3},
{id:"ginger",name:"ג׳ינג׳ר",price:3},
{id:"wasabi",name:"וואסאבי",price:3}
];

// HELPERS
function $id(id){return document.getElementById(id);}
function showMessage(txt,isError=true){ const m=$id('messages'); m.textContent=txt; m.style.color=isError?'#b71c1c':'#2a7a2a'; setTimeout(()=>{ if(m.textContent===txt) m.textContent='';},6000);}
function generateUUID(){ return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){ const r=Math.random()*16|0,v=c==='x'?r:(r&0x3|0x8);return v.toString(16);});}

// RENDER
function createRollCard(item,containerId){
  const container=$id(containerId);
  const card=document.createElement('div'); card.className='roll-card'; card.dataset.id=item.id; card.dataset.price=item.price;
  const info=document.createElement('div'); info.className='info'; info.innerHTML=`<h3>${item.name}</h3><p>${item.description}</p>`;
  const controls=document.createElement('div'); controls.className='quantity-control';
  const btnMinus=document.createElement('button'); btnMinus.textContent='−';
  const inputQty=document.createElement('input'); inputQty.type='number'; inputQty.value=selectedRolls[item.id]||0; inputQty.readOnly=true;
  const btnPlus=document.createElement('button'); btnPlus.textContent='+';
  btnPlus.addEventListener('click',()=>{ selectedRolls[item.id]=(selectedRolls[item.id]||0)+1; inputQty.value=selectedRolls[item.id]; updateSummary();});
  btnMinus.addEventListener('click',()=>{ if((selectedRolls[item.id]||0)>0){selectedRolls[item.id]--; inputQty.value=selectedRolls[item.id]; updateSummary();}});
  controls.append(btnMinus,inputQty,btnPlus); card.append(info,controls); container.appendChild(card);
}

function createSauceCard(item){
  const container=$id('sauces-container');
  const card=document.createElement('div'); card.className='roll-card'; card.dataset.id=item.id; card.dataset.price=item.price;
  const info=document.createElement('div'); info.className='info'; info.innerHTML=`<h3>${item.name}</h3>`;
  const controls=document.createElement('div'); controls.className='quantity-control';
  const btnMinus=document.createElement('button'); btnMinus.textContent='−';
  const inputQty=document.createElement('input'); inputQty.type='number'; inputQty.value=selectedSauces[item.id]||0; inputQty.readOnly=true;
  const btnPlus=document.createElement('button'); btnPlus.textContent='+';
  btnPlus.addEventListener('click',()=>{ selectedSauces[item.id]=(selectedSauces[item.id]||0)+1; inputQty.value=selectedSauces[item.id]; updateSummary();});
  btnMinus.addEventListener('click',()=>{ if((selectedSauces[item.id]||0)>0){selectedSauces[item.id]--; inputQty.value=selectedSauces[item.id]; updateSummary();}});
  controls.append(btnMinus,inputQty,btnPlus); card.append(info,controls); container.appendChild(card);
}

function renderMenu(){
  insideOutRollsData.forEach(r=>createRollCard(r,'insideout-rolls'));
  makiRollsData.forEach(r=>createRollCard(r,'maki-rolls'));
  onigiriData.forEach(r=>createRollCard(r,'onigiri-rolls'));
  pokeData.forEach(r=>createRollCard(r,'poke-rolls'));
  oshizushiData.forEach(r=>createRollCard(r,'oshizushi-rolls'));
  saucesData.forEach(r=>createSauceCard(r));
}

function updateSummary(){
  let txt=""; let total=0;
  Object.entries(selectedRolls).forEach(([id,qty])=>{
    if(qty>0){
      let item=[...insideOutRollsData,...makiRollsData,...onigiriData,...pokeData,...oshizushiData].find(r=>r.id===id);
      txt+=`${item.name} x${qty} = ${item.price*qty}₪\n`;
      total+=item.price*qty;
    }
  });
  Object.entries(selectedSauces).forEach(([id,qty])=>{
    if(qty>0){
      let item=saucesData.find(s=>s.id===id);
      txt+=`${item.name} x${qty} = ${item.price*qty}₪\n`;
      total+=item.price*qty;
    }
  });
  txt+=`\nסכום כולל: ${total}₪`;
  $id('order-summary').textContent=txt;
  $id('send-order').disabled=(total===0||!currentUser);
}

// TABS
document.querySelectorAll('.tab').forEach(tab=>{
  tab.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    document.querySelectorAll('.category-container').forEach(c=>c.style.display='none');
    $id(tab.dataset.target).style.display='flex';
  });
});

// CHOPSTICKS
$id('chopsticks-plus').addEventListener('click',()=>{ chopsticksCount++; $id('chopsticks-qty').value=chopsticksCount; updateSummary();});
$id('chopsticks-minus').addEventListener('click',()=>{ if(chopsticksCount>1){chopsticksCount--; $id('chopsticks-qty').value=chopsticksCount; updateSummary();}});

// SEND ORDER
$id('send-order').addEventListener('click',()=>{
  if(Object.values(selectedRolls).every(q=>q===0)){showMessage("יש לבחור לפחות רול אחד!"); return;}
  if(!currentUser){showMessage("אנא התחבר לפני השליחה."); return;}
  const payload={
    user: currentUser,
    rolls:selectedRolls,
    sauces:selectedSauces,
    chopsticks: chopsticksCount,
    notes:$id('notes').value,
    timestamp: new Date().toISOString()
  };
  fetch(MAKE_WEBHOOK_URL,{
    method:'POST',
    body:JSON.stringify(payload),
    headers:{'Content-Type':'application/json'}
  }).then(r=>{if(r.ok){showMessage("ההזמנה נשלחה בהצלחה!",false); resetOrder();} else showMessage("שגיאה בשליחת ההזמנה.");}).catch(e=>showMessage("שגיאה ברשת."));
});

function resetOrder(){
  selectedRolls={};
  selectedSauces={};
  chopsticksCount=1;
  $id('chopsticks-qty').value=1;
  Object.values(document.querySelectorAll('.quantity-control input')).forEach(i=>i.value=0);
  $id('notes').value='';
  updateSummary();
}

// PROFILE BUTTON
function initGoogleSignIn(){
  google.accounts.id.initialize({
    client_id: GOOGLE_CLIENT_ID,
    callback: handleCredentialResponse
  });
  $id('profile-btn').addEventListener('click',()=>{
    if(currentUser){showMessage(`אתה כבר מחובר כ${currentUser.name}`,false);}
    else google.accounts.id.prompt();
  });
}

function handleCredentialResponse(response){
  const user = jwt_decode(response.credential);
  currentUser={name:user.name,email:user.email,picture:user.picture};
  localStorage.setItem('currentUser',JSON.stringify(currentUser));
  $id('profile-btn').textContent=currentUser.name;
  updateSummary();
}

// INIT
document.addEventListener('DOMContentLoaded',()=>{
  renderMenu();
  initGoogleSignIn();
  updateSummary();
  // populate pickup times
  const now=new Date(); for(let i=0;i<12;i++){let t=new Date(now.getTime()+i*30*60000); $id('pickup-time').innerHTML+=`<option value="${t.toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'})}">${t.toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'})}</option>`;}
});
</script>
</body>
</html>
