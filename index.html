<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Sushi Shifu</title>

  <!-- Supabase client (UMD) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- jwt-decode -->
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>

  <style>
    * {
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

input, textarea, select {
  -webkit-user-select: text;
  user-select: text;
}
:root{
  --accent:#cb7e3d;
  --accent-dark:#5e1b1b;
  --muted:#3a3a3a;    /* ××¤×•×¨ ×¢×“×™×Ÿ ×™×•×ª×¨ */
  --danger:#d9534f;
}
    *{box-sizing:border-box}
 
body{
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: linear-gradient(180deg, #1a0505, #000000);
  direction: rtl;
  color: #f5f5f5;
  font-size: 16px;
}

.container{
  max-width:1020px;
  margin:18px auto;
  padding:18px;
  background: #1a1a1a;
  border-radius:12px;
  box-shadow:0 6px 20px rgba(255,255,255,0.1);
  color: #fff;
}
    
    header{
  display:flex;
  align-items:center;
  justify-content: center; 
  padding: 10px 20px;
  gap:12px;
  position: relative;
  margin-bottom:10px;
}

.logo {
     /* ×’×•×‘×” ×§×‘×•×¢ */
  width: auto;     /* ×¨×•×—×‘ ××©×ª× ×” ×œ×¤×™ ×”×¤×¨×•×¤×•×¨×¦×™×” */
  border-radius: 8px;
  display: block;
}

.user-buttons {
  display: flex;
  gap: 6px;
  align-items: center;
  margin-left: auto;       /* ×“×•×—×£ ×œ×¦×“ ×™××™×Ÿ */
}

h1 {
  margin: 85px 0 0 ;
  color: #f0f0f0;
  font-size: 1.5rem;
  text-align: center;
  width: 100%;
}
.tabs{
  display: flex;
  gap: 4px;
  flex-wrap: nowrap;
  overflow-x: auto;
  margin: 60px 0 20px 0;
}

.tab-btn {
  padding: 7px 8px;
  border: none;
  background: var(--muted);
  color: #b0b0b0;
  border-radius: 6px;
  cursor: pointer;
  white-space: nowrap;
  flex-shrink: 0;
  font-size: 0.88rem;
  font-weight: 400;
  transition: all 0.3s ease;
}

.tab-btn.active { 
  background: #cb7e3d; 
  color: #fff;
  font-weight: 700;
  box-shadow: 0 0 1px rgba(122, 42, 42, 0.8), 0 0 2px rgba(122, 42, 42, 0.4);
}

.tab-btn:hover {
  background: #cb7e3d
  color: #e0e0e0;
  box-shadow: 0 0 5px rgba(122, 42, 42, 0.3);
}

.tab-btn.active:hover {
  background: #cb7e3d;
  box-shadow: 0 0 5px rgba(122, 42, 42, 0.9), 0 0 2px rgba(122, 42, 42, 0.5);
}
    
.category-title{
  font-weight: 700;
  color: #cb7e3d;
  margin: 18px 0 8px 0;
  padding-bottom: 6px;
  border-bottom: 2px solid rgba(122,42,42,0.12);
  font-size: 1.3rem;
}
  
  .category-container{
    display:flex;
    flex-direction:column;
    gap:5px;
    }

.roll-card{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  padding:12px;
  border-radius:10px;
  background:#252525;
  box-shadow:0 3px 8px rgba(0,0,0,0.3);
}
    .roll-card .info{
      flex:1 1 auto;
    }
    .roll-card h3{ 
  margin: 0 0 6px 0; 
  color: #adb745; 
  font-size: 1.25rem;
   }
    
    .roll-card p{ 
  margin: 0; 
  color: #f5f5f5; 
  font-size: 1rem;
  line-height: 1.4;
}

    .quantity-control{
      display:flex;
      align-items:center;
      gap:8px;
    }

.quantity-control button{
  width:30px; height:30px;
  border-radius:8px;
  border:none;
  background:#ddd;
  color:#000;
  font-weight:400;
  font-size:1.2rem;
  cursor:pointer;
}
    .quantity-control button:active{ transform:translateY(1px); }
    .quantity-control input{
      width:40px;
      text-align:center;
      border:1px solid #ddd;
      border-radius:6px;
      padding:6px;
      background:#fff;
    }

    .note{ color:#6b6b6b; margin:6px 0 0 0; font-size:0.92rem; }
    .small{ font-size:0.86rem; color:#8a8a8a; }

#profile-btn {
  background: none;
  border: none;
  padding: 0;
  cursor: pointer;
}
#profile-btn img {
  transition: transform 0.2s ease;
}
#profile-btn img:hover {
  transform: scale(1.05);
}


#phone-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.8);
  z-index: 9999;
  align-items: center;
  justify-content: center;
  display: none;
  margin: 0;
  padding: 0;
  overflow: hidden;
}

#phone-modal.show {
  display: flex !important;
}

#phone-input:focus {
  outline: none;
  border-color: #cdb754;
  box-shadow: 0 0 0 2px rgba(122, 42, 42, 0.2);
}

/* ×× ×™×¢×ª ×’×œ×™×œ×” ×›×©-modal ×¤×ª×•×— */
body.modal-open {
  overflow: hidden;
  margin: 0;
  padding: 0;
}
   
#notes{
  width: 100%;
  padding: 12px;
  border: 1px solid #444;
  border-radius: 6px;
  font-family: inherit;
  resize: vertical;
  min-height: 70px;
  background: #2a2a2a;
  color: #adb754;
  font-size: 1rem;
}
#pickup-time{
  width: 100%;
  padding: 12px;
  border: 1px solid #444;
  border-radius: 6px;
  font-size: 1.05rem;
  background: #2a2a2a;
  color: #f0f0f0;
}

#order-summary{
  background: #2a2a2a;
  color: #f0f0f0;
  padding: 16px;
  border-radius: 8px;
  min-height: 110px;
  white-space: pre-wrap;
  font-family: "Courier New", monospace;
  margin-top: 12px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.3);
  font-size: 0.95rem;
  line-height: 1.5;
}

    #send-order{
  margin-top: 12px;
  padding: 14px 20px;
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 1.15rem;
  font-weight: 600;
  cursor: pointer;
  width: 100%;
}
#send-order:disabled{ 
  background: #bbb; 
  cursor: not-allowed; 
}
    #messages{
      margin-top:12px;
      color:var(--danger);
      font-weight:700;
    }

    .profile-panel{
      background: #2a2a2a;
      color: #f0f0f0;
      border-radius:8px;
      padding:10px;
      margin-top:10px;
      box-shadow:0 3px 8px rgba(0,0,0,0.06);
    }
    #order-history .history-item{
      border-top:1px dashed #ddd;
      background: #2a2a2a;
      color: #f0f0f0;
      padding:8px 0;
    }

    .user-buttons button{
      padding:8px 14px;
      border:none;
      border-radius:6px;
      cursor:pointer;
      background:var(--accent);
      color:#fff;
      font-weight:600;
    }

    @media (max-width:720px){
      header{ flex-direction:column; align-items:flex-start; }
      .roll-card{ flex-direction:column; align-items:flex-start; }
      .quantity-control{ margin-top:8px; }
      .container{ padding:12px; }
    }
  </style>
</head>
<body>
  <div class="container">
<div id="phone-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; align-items:center; justify-content:center;">
  <div style="background:#1a1a1a; padding:30px; border-radius:12px; max-width:400px; width:90%; text-align:center; box-shadow:0 10px 40px rgba(0,0,0,0.5);">
    <h3 style="color:#7a2a2a; margin:0 0 10px 0; font-size:1.3rem;">×”×•×“×¢×” ×-Shifu</h3>
    <p style="color:#b0b0b0; margin:0 0 20px 0; font-size:1rem;">× × ×œ×”×–×™×Ÿ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×‘×¤×•×¨××˜: 05X-XXXXXXX</p>
    <input type="tel" id="phone-input" placeholder="050-1234567" style="width:100%; padding:12px; border:1px solid #444; border-radius:6px; background:#2a2a2a; color:#f0f0f0; font-size:1.1rem; text-align:center; direction:ltr;">
    <div style="margin-top:20px; display:flex; gap:10px;">
      <button onclick="submitPhone()" style="flex:1; padding:12px; background:#7a2a2a; color:#fff; border:none; border-radius:6px; font-size:1rem; font-weight:600; cursor:pointer;">××™×©×•×¨</button>
      <button onclick="cancelPhone()" style="flex:1; padding:12px; background:#3a3a3a; color:#b0b0b0; border:none; border-radius:6px; font-size:1rem; font-weight:600; cursor:pointer;">×‘×™×˜×•×œ</button>
    </div>
    <p id="phone-error" style="color:#d9534f; margin:15px 0 0 0; font-size:0.9rem; display:none;"></p>
  </div>
</div>

<div class="container">

<header style="
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 20px;
  position: relative;
">
  <!-- ×¦×“ ×™××™×Ÿ -->
  <div class="user-buttons" style="position: absolute; right: 5px;">
    <div id="login-btn"></div>
    <button id="profile-btn" style="display:none;">×”×¤×¨×•×¤×™×œ ×©×œ×™</button>
  </div>

  <!-- ×××¦×¢ -->
  <img src="https://i.imgur.com/m6KeXAB.jpeg" alt="×œ×•×’×•" class="logo" style="height: 140px; margin: 0 auto; display: block;">
  
  <!-- ×›×•×ª×¨×ª ××ª×—×ª ××• ×‘××¨×›×– -->
  <h1 style="position: absolute; left: 50%; transform: translateX(-50%); top: 80px;">
    ×ª×¤×¨×™×˜ â€” Sushi Shifu
  </h1>
</header>


    <nav class="tabs">
      <button class="tab-btn active" data-target="insideout">Inside-out</button>
      <button class="tab-btn" data-target="maki">Maki</button>
      <button class="tab-btn" data-target="onigiri">Onigiri</button>
      <button class="tab-btn" data-target="oshizushi">Oshizushi</button>
      <button class="tab-btn" data-target="poke">Poke</button>
      <button class="tab-btn" data-target="sauces">×¨×˜×‘×™×</button>
    </nav>

    <main>
      <section id="menu-section">
        <div id="insideout" class="menu-category">
          <div class="category-title">Inside-out Rolls</div>
          <div id="insideout-rolls" class="category-container"></div>
        </div>

        <div id="maki" class="menu-category" style="display:none">
          <div class="category-title">Maki Rolls</div>
          <div id="maki-rolls" class="category-container"></div>
        </div>

        <div id="onigiri" class="menu-category" style="display:none">
          <div class="category-title">Onigiri</div>
          <div id="onigiri-rolls" class="category-container"></div>
        </div>

        <div id="oshizushi" class="menu-category" style="display:none">
          <div class="category-title">Oshizushi</div>
          <div id="oshizushi-rolls" class="category-container"></div>
        </div>

        <div id="poke" class="menu-category" style="display:none">
          <div class="category-title">Poke</div>
          <div id="poke-rolls" class="category-container"></div>
        </div>

        <div id="sauces" class="menu-category" style="display:none">
          <div class="category-title">×¨×˜×‘×™×</div>
          <div id="sauces-container" class="category-container"></div>
          <p class="note">×›×œ ×¨×•×œ ××§×‘×œ 2 ×¨×˜×‘×™× ×—×™× ×. ×¨×•×˜×‘ × ×•×¡×£ ×¢×•×œ×” 3â‚ª.</p>
        </div>
      </section>

      <section id="chopsticks">
        <div class="category-title">×›××•×ª ×¦'×•×¤×¡×˜×™×§×¡</div>
        <div class="quantity-control">
          <button id="chopsticks-minus">âˆ’</button>
          <input id="chopsticks-qty" type="number" readonly value="1">
          <button id="chopsticks-plus">+</button>
        </div>
      </section>

      <section id="notes-section">
        <div class="category-title">×”×¢×¨×•×ª ××™×©×™×•×ª</div>
<textarea id="notes" placeholder="×”×¢×¨×•×ª ×œ××©×œ: ×‘×¨×•×œ × ×™×•×˜×•×Ÿ, ×œ×œ× ×¨×•×˜×‘ ×‘×•×˜× ×™×" oninput="updateSummary()"></textarea>
      </section>

      <section id="pickup-section">
        <div class="category-title">×‘×—×¨ ×©×¢×ª ××™×¡×•×£</div>
          <select id="pickup-time" onchange="updateSummary()">
        <option value="">×‘×—×¨ ×©×¢×”</option>
      </select>
        <p class="note small" id="pickup-note">×”×©×¢×•×ª ×”×–××™× ×•×ª ××ª×¢×“×›× ×•×ª ×‘×”×ª×× ×œ×”×–×× ×•×ª ×§×™×™××•×ª</p>
      </section>

      <section id="summary-section">
        <div class="category-title">×¡×™×›×•× ×”×–×× ×”</div>
        <pre id="order-summary">×”×–×× ×” ×¨×™×§×” â€” ×‘×—×¨ ×¨×•×œ×™×, ×¨×˜×‘×™× ×•×©×¢×” ×œ×”×¦×’×ª ×”×¡×™×›×•×.</pre>
        <button id="send-order">×©×œ×— ×”×–×× ×”</button>
      </section>
      <div id="messages" aria-live="polite"></div>
      <div id="profile-page" style="display:none;">
      <div class="category-title">ğŸ‘¤ ×”×¤×¨×•×¤×™×œ ×©×œ×™</div>
  
  <!-- ×¤×¨×˜×™× ××™×©×™×™× -->
  <div style="background: #2a2a2a;
  color: #f0f0f0; padding:20px; border-radius:10px; margin-bottom:20px; box-shadow:0 3px 8px rgba(0,0,0,0.06);">
    <h3 style="margin-top:0; color:var(--accent);">×¤×¨×˜×™× ××™×©×™×™×</h3>
    
    <!-- ××¦×‘ ×ª×¦×•×’×” -->
    <div id="profile-view-mode">
      <p style="margin:10px 0;"><strong>×©× ××œ×:</strong> <span id="display-name"></span></p>
      <p style="margin:10px 0;"><strong>××™××™×™×œ:</strong> <span id="display-email"></span></p>
      <p style="margin:10px 0;"><strong>×˜×œ×¤×•×Ÿ:</strong> <span id="display-phone"></span></p>
      
      <button id="edit-mode-btn" style="margin-top:15px; padding:10px 20px; background:var(--accent); color:#fff; border:none; border-radius:6px; cursor:pointer;">
        âœï¸ ×¢×¨×•×š ×¤×¨×˜×™×
      </button>
    </div>
    
    <!-- ××¦×‘ ×¢×¨×™×›×” -->
    <div id="profile-edit-mode" style="display:none;">
      <div style="margin:15px 0;">
        <label style="display:block; margin-bottom:5px; font-weight:600;">×©× ××œ×:</label>
        <input type="text" id="edit-name" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;">
      </div>
      
      <div style="margin:15px 0;">
        <label style="display:block; margin-bottom:5px; font-weight:600;">×˜×œ×¤×•×Ÿ:</label>
        <input type="tel" id="edit-phone" placeholder="0501234567" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;">
        <small style="color:#888;">×¤×•×¨××˜: 10 ×¡×¤×¨×•×ª, ××ª×—×™×œ ×‘-05/02/03/04/08/09</small>
      </div>
      
      <div style="margin-top:15px; display:flex; gap:10px;">
        <button id="save-profile-btn" style="padding:20px 10px; background:#28a745; color:#fff; border:none; border-radius:6px; cursor:pointer;">
          âœ… ×©××•×¨ ×©×™× ×•×™×™×
        </button>
        <button id="cancel-edit-btn" style="padding:10px 20px; background:#6c757d; color:#fff; border:none; border-radius:6px; cursor:pointer;">
          âŒ ×‘×™×˜×•×œ
        </button>
      </div>
    </div>
  </div>
  
  <!-- ×”×™×¡×˜×•×¨×™×™×ª ×”×–×× ×•×ª -->
  <div style="background: #2a2a2a;
  color: #f0f0f0; padding:20px; border-radius:10px; margin-bottom:20px; box-shadow:0 3px 8px rgba(0,0,0,0.06);">
    <h3 style="margin-top:0; color:var(--accent);">×”×™×¡×˜×•×¨×™×™×ª ×”×–×× ×•×ª</h3>
    <div id="order-history"></div>
  </div>
  
  <!-- ×›×¤×ª×•×¨ ×”×ª× ×ª×§×•×ª -->
  <div style="text-align:center; margin-top:30px;">
    <button id="logout-btn-profile" style="padding:12px 30px; background:var(--danger); color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:1rem;">
      ğŸšª ×”×ª× ×ª×§
    </button>
  </div>
  
  <!-- ×›×¤×ª×•×¨ ×—×–×¨×” ×œ×ª×¤×¨×™×˜ -->
  <div style="text-align:center; margin-top:15px;">
    <button id="back-to-menu-btn" style="padding:10px 25px; background:var(--accent); color:#fff; border:none; border-radius:6px; cursor:pointer;">
      â† ×—×–×•×¨ ×œ×ª×¤×¨×™×˜
    </button>
  </div>
</div>
    </main>

  </div>

  <script>
    
document.addEventListener('dblclick', function(e) {
  e.preventDefault();
}, { passive: false });

// ×× ×™×¢×ª ×–×•× ×‘×¤×™× ×¥'
document.addEventListener('touchstart', function(e) {
  if (e.touches.length > 1) {
    e.preventDefault();
  }
}, { passive: false });

let lastTouchEnd = 0;
document.addEventListener('touchend', function(e) {
  const now = Date.now();
  if (now - lastTouchEnd <= 300) {
    e.preventDefault();
  }
  lastTouchEnd = now;
}, { passive: false });

// ×× ×™×¢×ª ××—×•×•×ª ×–×•×
document.addEventListener('gesturestart', function(e) {
  e.preventDefault();
});
    // ========================================
    // ×”×’×“×¨×•×ª ×¨××©×•× ×™×•×ª
    // ========================================
    
    // ×”×’×“×¨×ª Supabase
 const SUPABASE_URL = 'https://oxjokdjwdvmmdtcvqvon.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im94am9rZGp3ZHZtbWR0Y3Zxdm9uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwNzgwMzMsImV4cCI6MjA3NDY1NDAzM30.DmKp79UiPi9iOU50UutevdqRcPyREMUJ7NT5ZmBHDsg';

let supabase = null;

// ×”××ª×Ÿ ×œ×˜×¢×™× ×ª Supabase ×•××– ×¦×•×¨ ×—×™×‘×•×¨
if (typeof window.supabase !== 'undefined') {
  supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  console.log('âœ… Supabase ××—×•×‘×¨ ×‘×”×¦×œ×—×”!');
} else {
  console.error('âŒ Supabase ×œ× × ×˜×¢×Ÿ - ×‘×“×•×§ ××ª ×”×¡×§×¨×™×¤×˜');
}

const GOOGLE_CLIENT_ID = "962297663657-7bsrugivo5rjbu534lamiuc256gbqoc4.apps.googleusercontent.com";
const MAKE_WEBHOOK_URL = "https://hook.eu2.make.com/asitqrbtyjum10ph3vf6gxhkd766us3r";

// ××™××™×™×œ ×× ×”×œ (×œ××™×¤×•×¡)
const ADMIN_EMAIL = 'kgandashi@gmail.com';

// ×–××Ÿ ×”×›× ×” ×œ×¨×•×œ (×‘×“×§×•×ª)
const PREP_TIME_PER_ROLL = 10;
    // ========================================
    // ×ª×¤×¨×™×˜ - × ×ª×•× ×™×
    // ========================================

    const menuData = {
      insideout: [
        {name: '×¨×•×œ ×‘×™× ×’×•', desc: '×¡×œ××•×Ÿ × ×, ×©×× ×ª, ××‘×•×§×“×• ×‘×¦×™×¤×•×™ ×©×•××©×•× ×§×œ×•×™', price: 50},
        {name: '×¨×•×œ ×œ×•× ×”', desc: '×¡×¤×™×™×¡×™ ×¡×œ××•×Ÿ ××¤×•×™ ×¢×œ ×¨×•×œ ×‘×˜×˜×”, ××‘×•×§×“×• ×•×©×™×˜××§×™', price: 50},
        {name: '×¨×•×œ ×¨×™×™', desc: '×˜×¨×˜×¨ ×¡×¤×™×™×¡×™ ×˜×•× ×” × × ×¢×œ ×¨×•×œ ××œ×¤×¤×•×Ÿ, ×¢×™×¨×™×ª ×•××•×©×™× ×§×•', price: 55},
        {name: '×¨×•×œ ×§×¨×™×™×–×™ ×‘×¨×•× ×•', desc: '×“×’ ×œ×‘×Ÿ, ×˜×•× ×”, ×¡×œ××•×Ÿ ×‘×¦×™×¤×•×™ ×©×•××©×•× ×§×œ×•×™', price: 60},
        {name: '×¨×•×œ ×”××¤×™ ×‘×¨×•× ×•', desc: '×¡×œ××•×Ÿ ×‘×¦×™×¤×•×™ ×©×§×“×™× ×§×œ×•×™×™× ×•×¨×•×˜×‘ ×˜×¨×™××§×™', price: 60},
        {name: '×¨×•×œ ××™×œ×”', desc: '×‘×˜×˜×”, ×¢×™×¨×™×ª ×•××‘×•×§×“×• ×‘×¢×™×˜×•×£ ×¡×œ××•×Ÿ ×¦×¨×•×‘', price: 50},
        {name: '×¨×•×œ × ×™×•×˜×•×Ÿ', desc: '×˜×•× ×” ××“×•××”, ××‘×•×§×“×•, ×‘×˜×˜×” ×‘×¦×™×¤×•×™ ×¤× ×§×• ×•×¨×•×˜×‘ ×‘×•×˜× ×™×', price: 55},
        {name: '×¨×•×œ ××•×œ×™', desc: '×“×’ ×œ×‘×Ÿ, ××œ×¤×¤×•×Ÿ, ××‘×•×§×“×• ×‘×¦×™×¤×•×™ ×©×•××©×•×', price: 50},
        {name: '×¨×•×œ ××™×œ×™', desc: '××§×œ ×¡×•×¨×™××™, ×“×’ ×œ×‘×Ÿ ××¤×•×™, ××•×©×™× ×§×• ×‘×¦×™×¤×•×™ ×¤× ×§×•', price: 50},
        {name: '×¨×•×œ ×¡×§××¨', desc: '×¡×¤×™×™×¡×™ ×¡×œ××•×Ÿ ××¤×•×™ ×¢× ××‘×•×§×“×•, ××œ×¤×¤×•×Ÿ ×•×‘×˜×˜×” ×‘×¢×™×˜×•×¨ ××™×•× ×– ×•×¦\'×™×¤×¡', price: 50},
        {name: '×¨×•×œ ××’×™ ğŸŒ±', desc: '××œ×¤×¤×•×Ÿ, ×‘×˜×˜×”, ×¢×™×¨×™×ª ×•××‘×•×§×“×• ×‘×¢×™×˜×•×¨ ×‘×˜×˜×” ×•×¨×•×˜×‘ ×‘×•×˜× ×™×', price: 40},
        {name: '×¨×•×œ ×§×™×™×œ×”', desc: '×¡×œ××•×Ÿ × ×, ×§× ×¤×™×•, ×‘×˜×˜×” ×‘×¢×™×˜×•×£ ×©×‘×‘×™ ×¤× ×§×• ×¡×’×•×œ', price: 50},
        {name: '×¨×•×œ ×˜×™×™×¡×•×Ÿ', desc: '×¨×•×œ ××˜×•×’×Ÿ! ×¡×œ××•×Ÿ, ×‘×˜×˜×” ×•××œ×¤×¤×•×Ÿ ×‘×¦×™×¤×•×™ ×§×¨×™×¡×¤×™ ×•×¨×•×˜×‘ ×˜×¨×™××§×™', price: 60},        
        {name: '×¨×•×œ ×œ×•×¡×™', desc: '×¡×œ××•×Ÿ × ×, ×¤×˜×¨×™×•×ª ×©×™×˜××§×™ ×•××•×©×™× ×§×• ×‘×¦×™×¤×•×™ ×˜×•×‘×™×§×•', price: 55},
        {name: '×¨×•×œ ×‘×™×œ×™', desc: '×“×’ ×œ×‘×Ÿ ×¦×¨×•×‘, ×¢×™×¨×™×ª, ×‘×˜×˜×” ××¦×•×¤×” ×‘×¤× ×§×•', price: 50},
        {name: '×¨×•×œ ×œ××§×™', desc: '×˜×¨×˜×¨ ×¡×¤×™×™×¡×™ ×¡×œ××•×Ÿ ×¢× ××‘×•×§×“×•, ××œ×¤×¤×•×Ÿ ×•×¢×™×¨×™×ª', price: 50}
      ],
      
      maki: [
        {name: '×¨×•×œ ××œ×¤×™', desc: '×××§×™ ×¡×œ××•×Ÿ', price: 35},
        {name: '×¨×•×œ ××™×™ ××™×™ ğŸŒ±', desc: '×××§×™ ×‘×˜×˜×” ×•××‘×•×§×“×•', price: 25},
        {name: '×¨×•×œ ×¡× ×•×¤×™ ğŸŒ±', desc: '×××§×™ ××•×©×™× ×§×• ×•×§× ×¤×™×•', price: 25}
      ],
      
      onigiri: [
        {name: '××•× ×™×’×™×¨×™ ×¨×•×§×™', desc: '×˜×¨×˜×¨ ×˜×•× ×” ××“×•××” ×¢× ×¡×¤×™×™×¡×™ ××™×•× ×– ×•×‘×¦×œ ×™×¨×•×§', price: 35},
        {name: '××•× ×™×’×™×¨×™ ×’\'×•× ×™', desc: '×˜×¨×˜×¨ ×¡×œ××•×Ÿ ×¢× ×¡×¤×™×™×¡×™ ××™×•× ×– ×•×‘×¦×œ ×™×¨×•×§', price: 30},
        {name: '××•× ×™×’×™×¨×™ ×’\'×™×–×œ ğŸŒ±', desc: '××‘×•×§×“×• ×•×‘×˜×˜×”', price: 25}
      ],
      
      oshizushi: [
        {name: '××•×©×™×–×•×©×™ ×¡×œ××•×Ÿ ×§×œ××¡×™', desc: '6 ×™×—\' - ×¡×œ××•×Ÿ ×˜×¨×™ ×œ×—×•×¥ ×¢×œ ××•×¨×– ×¡×•×©×™', price: 42},
        {name: '××•×©×™×–×•×©×™ ×˜×•× ×” ×¤×™×§× ×˜×™', desc: '6 ×™×—\' - ×˜×•× ×” ×‘××¨×™× ×“×” ×—×¨×™×¤×” ×¢×œ ××•×¨×–', price: 45},
        {name: '××•×©×™×–×•×©×™ ×¦××—×•× ×™ ğŸŒ±', desc: '6 ×™×—\' - ××‘×•×§×“×• ×•×‘×˜×˜×” ×œ×—×•×¦×™× ×¢×œ ××•×¨×–', price: 35}
      ],
      
      poke: [
        {name: '×‘×•×œ-×“×•×’', desc: '××•×¨×– ×¡×•×©×™, ×¡×œ××•×Ÿ ×‘××¨×™× ×“×”, ××“×××”, ××œ×¤×¤×•×Ÿ, ××‘×•×§×“×•, ×‘×¦×œ ×™×¨×•×§. ××¢×œ ×©×•××©×•× ×•×¨×•×˜×‘ ×¡×¤×™×™×¡×™ ××™×•× ×–', price: 60},
        {name: '×¤×™×˜-×‘×•×œ', desc: '××•×¨×– ×¡×•×©×™, ×˜×•× ×” ×‘××¨×™× ×“×”, ××“×××”, ×× ×’×•, ×›×¨×•×‘ ×¡×’×•×œ, ×¤×˜×¨×™×•×ª ×©×™×˜××§×™. ××¢×œ ×‘×¦×œ ×©××œ×•×˜ ××˜×•×’×Ÿ ×•×¨×•×˜×‘ ×× × ×¡ ××ª×•×§', price: 70},
        {name: '×‘×•×œ-×˜×¨×™×™×¨ ğŸŒ±', desc: '××•×¨×– ×¡×•×©×™, ××“×××”, ××œ×¤×¤×•×Ÿ, ×¤×˜×¨×™×•×ª ×©×™×˜××§×™, ×’×–×¨ ×•××‘×•×§×“×•. ××¢×œ ×©×•××©×•× ×•×¨×•×˜×‘ ×‘×•×˜× ×™×', price: 45}
      ],
      
      sauces: [
        {name: '×¡×¤×™×™×¡×™ ××™×•× ×–', price: 0},
        {name: '×¨×•×˜×‘ ×¡×•×™×”', price: 0},
        {name: '×¨×•×˜×‘ ×˜×¨×™××§×™', price: 0},
        {name: '×’\'×™× ×’\'×¨', price: 0},
        {name: '×•×•××¡×‘×™', price: 0}
      ]
    };

    // ========================================
    // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
    // ========================================

    let currentUser = null;
    let orderItems = {};
    let sauceSelections = {};
    let chopsticksCount = 1;
    let existingOrders = [];

    // ========================================
    // ××ª×—×•×œ
    // ========================================

    document.addEventListener('DOMContentLoaded', async function() {
  initGoogleAuth();
  checkLocalAuth();
  renderMenu();
  setupTabs();
  setupChopsticks();
  
  // ×˜×¢×™× ×ª ×–×× ×™ ×”×›× ×” ××”×˜×‘×œ×”
  await loadRecipePrepTimes();
  
  // ×˜×¢×™× ×ª ×”×–×× ×•×ª ×§×™×™××•×ª
  await loadExistingOrders();
  
  setupSendOrder();
  setupProfileButton();
  setupLogoutButton();
  updateSummary();
});

    // ========================================
    // Google OAuth
    // ========================================

  function initGoogleAuth() {
  if (!window.google?.accounts?.id) {
    console.log('Google OAuth ×œ× × ×˜×¢×Ÿ ×¢×“×™×™×Ÿ');
    setTimeout(initGoogleAuth, 500);
    return;
  }
  window.google.accounts.id.initialize({
    client_id: GOOGLE_CLIENT_ID,
    callback: handleGoogleLogin
  });
  window.google.accounts.id.renderButton(
    document.getElementById('login-btn'),
    { theme: 'filled_black', size: 'medium', text: 'signin', locale: 'he' }
  );
}
async function loadOrderHistory() {
  try {
    if (!currentUser) return;
    
    const { data, error } = await supabase
      .from('Sushi')
      .select('*')
      .eq('email', currentUser.email)
      .order('created_at', { ascending: false });

    if (error) throw error;

    const historyDiv = document.getElementById('order-history');
    if (!historyDiv) return;
    
    if (!data || data.length === 0) {
      historyDiv.innerHTML = '<p>××™×Ÿ ×”×–×× ×•×ª ×§×•×“××•×ª.</p>';
      return;
    }

    historyDiv.innerHTML = data.map(function(order) {
      return `
        <div class="history-item">
          <strong>${new Date(order.created_at).toLocaleDateString('he-IL')}</strong><br>
          ×©×¢×ª ××™×¡×•×£: ${order.pickup_time}<br>
          ×¡×”"×›: ${order.total_price}â‚ª
        </div>
      `;
    }).join('');
  } catch (err) {
    console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×™×¡×˜×•×¨×™×”:', err);
    showMessage('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×™×¡×˜×•×¨×™×”: ' + err.message, 'red');
  }
}
async function getValidPhone() {
  return new Promise((resolve) => {
    const modal = document.getElementById('phone-modal');
    const input = document.getElementById('phone-input');
    const errorMsg = document.getElementById('phone-error');
    
    // ×”×¦×’×ª ×”××•×“××œ
    modal.classList.add('show');
    input.value = '';
    errorMsg.style.display = 'none';
    input.focus();
    
    // ×¤×•× ×§×¦×™×” ×œ×¡×’×™×¨×ª ×”××•×“××œ
    window.cancelPhone = function() {
      modal.classList.remove('show');
      resolve(null);
    };
    
    // ×¤×•× ×§×¦×™×” ×œ××™×©×•×¨
    window.submitPhone = function() {
      let phone = input.value.trim();
      
      // ×”×¡×¨×ª ×¨×•×•×—×™× ×•××§×¤×™×
      let cleanPhone = phone.replace(/[\s-]/g, '');
      
      // ×•×œ×™×“×¦×™×”: ×—×™×™×‘ ×œ×”×™×•×ª 10 ×¡×¤×¨×•×ª ×©××ª×—×™×œ×•×ª ×‘-05
      const phoneRegex = /^05[0-9]\d{7}$/;
      
      if (phoneRegex.test(cleanPhone)) {
        // ×ª×™×§×•×Ÿ ×œ×¤×•×¨××˜ ×”×¨×¦×•×™: 05X-XXXXXXX
        phone = cleanPhone.slice(0, 3) + '-' + cleanPhone.slice(3);
        modal.classList.remove('show');
        resolve(phone);
      } else {
        // ×”×¦×’×ª ×©×’×™××”
        errorMsg.textContent = 'âŒ ××¡×¤×¨ ×œ× ×ª×§×™×Ÿ! × ×“×¨×©: 05X-XXXXXXX';
        errorMsg.style.display = 'block';
        input.focus();
      }
    };
    
    // ××¤×©×¨×•×ª ×œ×œ×—×•×¥ Enter ×œ××™×©×•×¨
    input.onkeypress = function(e) {
      if (e.key === 'Enter') {
        submitPhone();
      }
    };
  });
}    
async function handleGoogleLogin(response) {
  try {
    const decoded = jwt_decode(response.credential);
    const profilePicture = decoded.picture || null;
    
    // ×‘×“×™×§×” ×× ×”××©×ª××© ×›×‘×¨ ×§×™×™× ×‘-DB
    const { data: existingUser, error: fetchError } = await supabase
      .from('users')
      .select('*')
      .eq('email', decoded.email)
      .single();
    
    if (fetchError && fetchError.code !== 'PGRST116') {
      console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ××©×ª××©:', fetchError);
    }
    
    let userData;
    
    if (existingUser) {
      // ××©×ª××© ×§×™×™× - ×¢×“×›×•×Ÿ last_login ×•×ª××•× ×ª ×¤×¨×•×¤×™×œ
      const { data: updated, error: updateError } = await supabase
        .from('users')
        .update({ 
          last_login: new Date().toISOString(),
          profile_picture: profilePicture
        })
        .eq('email', decoded.email)
        .select()
        .single();
      
      if (updateError) {
        console.error('×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×ª×—×‘×¨×•×ª:', updateError);
      }
      
      userData = existingUser;
      
      // ×× ××™×Ÿ ×˜×œ×¤×•×Ÿ - ×‘×§×© ×•×¢×“×›×Ÿ ×‘-DB
      if (!userData.phone) {
        const phone = await getValidPhone();
        if (!phone) {
          showMessage('×”×ª×—×‘×¨×•×ª ×‘×•×˜×œ×” - × ×“×¨×© ××¡×¤×¨ ×˜×œ×¤×•×Ÿ', 'red');
          return;
        }
        
        // ×¢×“×›×•×Ÿ ×˜×œ×¤×•×Ÿ ×‘-DB
        const { error: phoneUpdateError } = await supabase
          .from('users')
          .update({ phone: phone })
          .eq('email', decoded.email);
        
        if (phoneUpdateError) {
          console.error('×©×’×™××” ×‘×¢×“×›×•×Ÿ ×˜×œ×¤×•×Ÿ:', phoneUpdateError);
          showMessage('×©×’×™××” ×‘×¢×“×›×•×Ÿ ×˜×œ×¤×•×Ÿ', 'red');
        }
        
        userData.phone = phone;
      }
      
    } else {
      // ××©×ª××© ×—×“×© - ×‘×§×© ×˜×œ×¤×•×Ÿ ×•×™×¦×™×¨×” ×‘-DB
      const phone = await getValidPhone();
      if (!phone) {
        showMessage('×”×ª×—×‘×¨×•×ª ×‘×•×˜×œ×” - × ×“×¨×© ××¡×¤×¨ ×˜×œ×¤×•×Ÿ', 'red');
        return;
      }
      
      const { data: newUser, error: insertError } = await supabase
        .from('users')
        .insert([{
          email: decoded.email,
          name: decoded.name,
          phone: phone,
          profile_picture: profilePicture,
          last_login: new Date().toISOString()
        }])
        .select()
        .single();
      
      if (insertError) {
        console.error('×©×’×™××” ×‘×™×¦×™×¨×ª ××©×ª××©:', insertError);
        showMessage('×©×’×™××” ×‘×™×¦×™×¨×ª ××©×ª××©: ' + insertError.message, 'red');
        return;
      }
      
      userData = newUser;
    }
    
    currentUser = {
      name: userData.name,
      email: userData.email,
      phone: userData.phone,
      picture: userData.profile_picture
    };
    
    // ×©××™×¨×” ×’× ×‘-localStorage ×œ×’×™×©×” ××”×™×¨×”
    localStorage.setItem('sushiUser', JSON.stringify(currentUser));
    
    showMessage('×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×”!', 'green');
    updateUIAfterLogin();
    
  } catch (err) {
    console.error('×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª:', err);
    showMessage('×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª: ' + err.message, 'red');
  }
}

    async function checkLocalAuth() {
  const stored = localStorage.getItem('sushiUser');
  if (stored) {
    const parsed = JSON.parse(stored);
    
    // ×‘×“×™×§×” ×× ×”××©×ª××© ×¢×“×™×™×Ÿ ×§×™×™× ×‘-DB ×•×¢×“×›×•×Ÿ ×”× ×ª×•× ×™×
    const { data: dbUser, error } = await supabase
      .from('users')
      .select('*')
      .eq('email', parsed.email)
      .single();
    
    if (dbUser) {
      currentUser = {
        name: dbUser.name,
        email: dbUser.email,
        phone: dbUser.phone,
        picture: dbUser.profile_picture
      };
      
      // ×¢×“×›×•×Ÿ localStorage ×¢× × ×ª×•× ×™× ×¢×“×›× ×™×™× ××”-DB
      localStorage.setItem('sushiUser', JSON.stringify(currentUser));
      
      updateUIAfterLogin();
    } else if (error && error.code !== 'PGRST116') {
      console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ××©×ª××©:', error);
      // ×× ×™×© ×©×’×™××” ××‘×œ ×™×© × ×ª×•× ×™× ××§×•××™×™×, × ×©×ª××© ×‘×”×
      currentUser = parsed;
      updateUIAfterLogin();
    }
  }
}

function updateUIAfterLogin() {
  const loginBtnContainer = document.getElementById('login-btn');
  const profileBtn = document.getElementById('profile-btn');

  // ×”×¡×ª×¨×ª ×›×œ ×”-container ×©×œ ×›×¤×ª×•×¨ ×”×›× ×™×¡×”
  if (loginBtnContainer) {
    loginBtnContainer.style.display = 'none';
    loginBtnContainer.innerHTML = ''; // × ×™×§×•×™ ×”×ª×•×›×Ÿ
    console.log('×”×¡×ª×¨×ª×™ ××ª ×›×¤×ª×•×¨ ×”×›× ×™×¡×”');
  }

  if (profileBtn) {
    profileBtn.style.display = 'inline-block';
    console.log('×”×¦×’×ª×™ ××ª ×›×¤×ª×•×¨ ×”×¤×¨×•×¤×™×œ');
    
    // ×× ×™×© ×ª××•× ×” ××”××©×ª××©, × ×—×œ×™×£ ××ª ×”×ª×•×›×Ÿ ×©×œ ×”×›×¤×ª×•×¨
    if (currentUser && currentUser.picture) {
      profileBtn.innerHTML = `<img src="${currentUser.picture}" 
                                   alt="×ª××•× ×ª ×¤×¨×•×¤×™×œ" 
                                   style="width:32px;height:32px;border-radius:50%;object-fit:cover;vertical-align:middle;">`;
      profileBtn.style.padding = '4px';
    } else {
      profileBtn.textContent = 'ğŸ‘¤ ×”×¤×¨×•×¤×™×œ ×©×œ×™';
      profileBtn.style.padding = '8px 14px';
    }
  }
}
    // ========================================
    // ×¤×¨×•×¤×™×œ
    // ========================================

function setupProfileButton() {
  document.getElementById('profile-btn').addEventListener('click', function() {
    showProfilePage();
  });
  
  // ×›×¤×ª×•×¨ ××¦×‘ ×¢×¨×™×›×”
  document.getElementById('edit-mode-btn').addEventListener('click', function() {
    enterEditMode();
  });
  
  // ×›×¤×ª×•×¨ ×©××™×¨×”
  document.getElementById('save-profile-btn').addEventListener('click', function() {
    saveProfileChanges();
  });
  
  // ×›×¤×ª×•×¨ ×‘×™×˜×•×œ
  document.getElementById('cancel-edit-btn').addEventListener('click', function() {
    exitEditMode();
  });
  
  // ×›×¤×ª×•×¨ ×—×–×¨×” ×œ×ª×¤×¨×™×˜
  document.getElementById('back-to-menu-btn').addEventListener('click', function() {
    hideProfilePage();
  });
  
  // ×›×¤×ª×•×¨ ×”×ª× ×ª×§×•×ª ××ª×•×š ×”×¤×¨×•×¤×™×œ
  document.getElementById('logout-btn-profile').addEventListener('click', function() {
    logoutUser();
  });
}
    
function showProfilePage() {
  // ×”×¡×ª×¨×ª ×˜××‘×™×
  document.querySelectorAll('.tab-btn').forEach(function(btn) {
    btn.classList.remove('active');
  });
  
  // ×”×¡×ª×¨×ª ×›×œ ×§×˜×’×•×¨×™×•×ª ×”×ª×¤×¨×™×˜
  document.querySelectorAll('.menu-category').forEach(function(cat) {
    cat.style.display = 'none';
  });
  
  // ×”×¡×ª×¨×ª ×¡×§×©× ×™× ×©×œ ×”×”×–×× ×”
  document.getElementById('chopsticks').style.display = 'none';
  document.getElementById('notes-section').style.display = 'none';
  document.getElementById('pickup-section').style.display = 'none';
  document.getElementById('summary-section').style.display = 'none';
  
  // ×”×¡×ª×¨×ª menu-section
  document.getElementById('menu-section').style.display = 'none';
  
  // ×”×¦×’×ª ×¢××•×“ ×”×¤×¨×•×¤×™×œ
  document.getElementById('profile-page').style.display = 'block';
  
  // ×˜×¢×™× ×ª × ×ª×•× ×™×
  loadProfileData();
  loadOrderHistory();
}
function setupLogoutButton() {
  // ×”×œ×•×’×™×§×” ×›×‘×¨ ××©×•×œ×‘×ª ×‘-setupProfileButton
  // ×”×¤×•× ×§×¦×™×” ×§×™×™××ª ×¨×§ ×›×“×™ ×©×”-DOMContentLoaded ×œ× ×™×™×ª×Ÿ ×©×’×™××”
}
function hideProfilePage() {
  // ×”×¡×ª×¨×ª ×”×¤×¨×•×¤×™×œ
  document.getElementById('profile-page').style.display = 'none';
  
  // ×”×¦×’×ª ×›×œ ×”×¡×§×©× ×™×
  document.getElementById('menu-section').style.display = 'block';
  document.getElementById('chopsticks').style.display = 'block';
  document.getElementById('notes-section').style.display = 'block';
  document.getElementById('pickup-section').style.display = 'block';
  document.getElementById('summary-section').style.display = 'block';
  
  // ×—×–×¨×” ×œ×˜××‘ ×”×¨××©×•×Ÿ
  document.querySelectorAll('.tab-btn').forEach(function(t) {
    t.classList.remove('active');
  });
  
  const firstTab = document.querySelector('.tab-btn[data-target="insideout"]');
  if (firstTab) {
    firstTab.classList.add('active');
  }
  
  // ×”×¦×’×ª insideout
  document.querySelectorAll('.menu-category').forEach(function(cat) {
    cat.style.display = 'none';
  });
  
  const insideoutSection = document.getElementById('insideout');
  if (insideoutSection) {
    insideoutSection.style.display = 'block';
  }
}

function loadProfileData() {
  if (!currentUser) return;
  
  document.getElementById('display-name').textContent = currentUser.name;
  document.getElementById('display-email').textContent = currentUser.email;
  document.getElementById('display-phone').textContent = currentUser.phone;
}

function enterEditMode() {
  document.getElementById('profile-view-mode').style.display = 'none';
  document.getElementById('profile-edit-mode').style.display = 'block';
  
  // ××™×œ×•×™ ×©×“×•×ª
  document.getElementById('edit-name').value = currentUser.name;
  document.getElementById('edit-phone').value = currentUser.phone;
}

function exitEditMode() {
  document.getElementById('profile-edit-mode').style.display = 'none';
  document.getElementById('profile-view-mode').style.display = 'block';
}

async function saveProfileChanges() {
  const newName = document.getElementById('edit-name').value.trim();
  const newPhone = document.getElementById('edit-phone').value.trim();
  
  // ×•×œ×™×“×¦×™×” - ×©×
  if (!newName || newName.length < 2) {
    showMessage('âŒ × × ×œ×”×–×™×Ÿ ×©× ×ª×§×™×Ÿ', 'red');
    return;
  }
  
  // ×•×œ×™×“×¦×™×” - ×˜×œ×¤×•×Ÿ
  const phoneRegex = /^0(5[0-9]|[2-4]|[8-9])\d{7}$/;
  if (!phoneRegex.test(newPhone.replace(/[-\s]/g, ''))) {
    showMessage('âŒ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿ. ×¤×•×¨××˜ × ×›×•×Ÿ: 0501234567', 'red');
    return;
  }
  
  // ×¢×“×›×•×Ÿ ××§×•××™
  currentUser.name = newName;
  currentUser.phone = newPhone.replace(/[-\s]/g, '');
  localStorage.setItem('sushiUser', JSON.stringify(currentUser));
  
  // ×¢×“×›×•×Ÿ ×‘-Supabase
  try {
    if (supabase) {
      const { error } = await supabase
        .from('Sushi')
        .update({ 
          user_name: currentUser.name,
          phone: currentUser.phone 
        })
        .eq('email', currentUser.email);
      
      if (error) throw error;
    }
    
    showMessage('âœ… ×”×¤×¨×˜×™× ×¢×•×“×›× ×• ×‘×”×¦×œ×—×”!', 'green');
    loadProfileData();
    exitEditMode();
    
  } catch (err) {
    console.error('×©×’×™××” ×‘×¢×“×›×•×Ÿ:', err);
    showMessage('âš ï¸ ×”×¤×¨×˜×™× × ×©××¨×• ××§×•××™×ª', 'orange');
    loadProfileData();
    exitEditMode();
  }
}

function logoutUser() {
  localStorage.removeItem('sushiUser');
  currentUser = null;
  document.getElementById('login-btn').style.display = 'block';
  document.getElementById('profile-btn').style.display = 'none';
  hideProfilePage();
  showMessage('×”×ª× ×ª×§×ª ×‘×”×¦×œ×—×”', 'green');
  async function loadOrderHistory() {
  // ... ×”×§×•×“ ××œ××¢×œ×”
}

function setupProfileButton() {
  // ... ×”×§×•×“ ××œ××¢×œ×”
}

function setupLogoutButton() {
  // ... ×”×§×•×“ ××œ××¢×œ×”
}

}
    // ========================================
    // ×¨×™× ×“×•×¨ ×ª×¤×¨×™×˜
    // ========================================

    function renderMenu() {
      renderCategory('insideout', 'insideout-rolls');
      renderCategory('maki', 'maki-rolls');
      renderCategory('onigiri', 'onigiri-rolls');
      renderCategory('oshizushi', 'oshizushi-rolls');
      renderCategory('poke', 'poke-rolls');
      renderSauces();
    }

    function renderCategory(category, containerId) {
      const container = document.getElementById(containerId);
      const items = menuData[category];
      
      container.innerHTML = items.map((item, idx) => {
        const key = `${category}_${idx}`;
        return `
          <div class="roll-card">
            <div class="info">
              <h3>${item.name}</h3>
              <p>${item.desc}</p>
              <p><strong>${item.price}â‚ª</strong></p>
            </div>
            <div class="quantity-control">
              <button onclick="changeQty('${key}', -1)">âˆ’</button>
              <input type="number" id="${key}" value="0" readonly>
              <button onclick="changeQty('${key}', 1)">+</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderSauces() {
      const container = document.getElementById('sauces-container');
      container.innerHTML = menuData.sauces.map((sauce, idx) => {
        const key = `sauce_${idx}`;
        return `
          <div class="roll-card">
            <div class="info">
              <h3>${sauce.name}</h3>
            </div>
            <div class="quantity-control">
              <button onclick="changeSauce('${key}', -1)">âˆ’</button>
              <input type="number" id="${key}" value="0" readonly>
              <button onclick="changeSauce('${key}', 1)">+</button>
            </div>
          </div>
        `;
      }).join('');
    }

    // ========================================
    // ×œ×©×•× ×™×•×ª (Tabs)
    // ========================================

function setupTabs() {
  const tabs = document.querySelectorAll('.tab-btn');
  tabs.forEach(function(tab) {
    tab.addEventListener('click', function() {
      console.log('ğŸ‘† ×œ×—×¦×ª ×¢×œ ×˜××‘:', tab.getAttribute('data-target'));
      
      // ×”×¡×ª×¨×ª ×¢××•×“ ×”×¤×¨×•×¤×™×œ
      const profilePage = document.getElementById('profile-page');
      if (profilePage) {
        profilePage.style.display = 'none';
      }
      
      // ×”×¦×’×ª ×›×œ ×”×¡×§×©× ×™× ×©×œ ×”×”×–×× ×”
      const menuSection = document.getElementById('menu-section');
      const chopsticksSection = document.getElementById('chopsticks');
      const notesSection = document.getElementById('notes-section');
      const pickupSection = document.getElementById('pickup-section');
      const summarySection = document.getElementById('summary-section');
      
      if (menuSection) menuSection.style.display = 'block';
      if (chopsticksSection) chopsticksSection.style.display = 'block';
      if (notesSection) notesSection.style.display = 'block';
      if (pickupSection) pickupSection.style.display = 'block';
      if (summarySection) summarySection.style.display = 'block';
      
      // ×”×¡×¨×ª active ××›×œ ×”×˜××‘×™×
      tabs.forEach(function(t) {
        t.classList.remove('active');
      });
      tab.classList.add('active');

      // ×”×¡×ª×¨×ª ×›×œ ×”×§×˜×’×•×¨×™×•×ª
      document.querySelectorAll('.menu-category').forEach(function(cat) {
        cat.style.display = 'none';
      });

      // ×”×¦×’×ª ×”×§×˜×’×•×¨×™×” ×”× ×‘×—×¨×ª
      const target = tab.getAttribute('data-target');
      const targetElement = document.getElementById(target);
      
      if (targetElement) {
        targetElement.style.display = 'block';
        console.log('âœ… ×”×¦×’×ª:', target);
      } else {
        console.error('âŒ ×œ× × ××¦×:', target);
      }
    });
  });
}
    // ========================================
    // ×›××•×™×•×ª ×¨×•×œ×™×
    // ========================================

window.changeQty = function(key, delta) {
  const input = document.getElementById(key);
  let val = parseInt(input.value) || 0;
  val = Math.max(0, val + delta);
  input.value = val;
  
  if (val > 0) {
    orderItems[key] = val;
  } else {
    delete orderItems[key];
  }
  
  console.log('ğŸ“¦ ×¢×•×“×›×Ÿ:', key, '=', val);
  console.log('ğŸ“‹ orderItems:', orderItems);
  
  // ×¢×“×›×•×Ÿ ×©×¢×•×ª ×–××™× ×•×ª ×œ×¤×™ ×”×”×–×× ×” ×”×—×“×©×”
  generatePickupSlots(); // ğŸ‘ˆ ×”×•×¡×£!
  
  updateSummary();
};

    // ========================================
    // ×¨×˜×‘×™×
    // ========================================

    window.changeSauce = function(key, delta) {
      const input = document.getElementById(key);
      let val = parseInt(input.value) || 0;
      val = Math.max(0, val + delta);
      input.value = val;
      
      if (val > 0) {
        sauceSelections[key] = val;
      } else {
        delete sauceSelections[key];
      }
      
      updateSummary();
    };

    // ========================================
    // ×¦'×•×¤×¡×˜×™×§×¡
    // ========================================

    function setupChopsticks() {
      document.getElementById('chopsticks-minus').addEventListener('click', () => {
        if (chopsticksCount > 0) {
          chopsticksCount--;
          document.getElementById('chopsticks-qty').value = chopsticksCount;
          updateSummary();
        }
      });

      document.getElementById('chopsticks-plus').addEventListener('click', () => {
        chopsticksCount++;
        document.getElementById('chopsticks-qty').value = chopsticksCount;
        updateSummary();
      });
    }

    // ========================================
    // ×˜×¢×™× ×ª ×”×–×× ×•×ª ×§×™×™××•×ª ×-Supabase
    // ========================================

    async function loadExistingOrders() {
  try {
    const today = new Date().toISOString().split('T')[0];
    const { data, error } = await supabase
      .from('Sushi')
      .select('pickup_time, items')
      .eq('order_date', today);

    if (error) throw error;

    existingOrders = data || [];
    generatePickupSlots();
  } catch (err) {
    console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×–×× ×•×ª:', err);
    generatePickupSlots();
  }
}
// ========================================
// ×˜×¢×™× ×ª ×–×× ×™ ×”×›× ×” ××˜×‘×œ×ª recipes
// ========================================

let recipePrepTimes = {};

async function loadRecipePrepTimes() {
  try {
    if (!supabase) {
      console.warn('Supabase ×œ× ××—×•×‘×¨ - ××©×ª××© ×‘×–×× ×™ ×‘×¨×™×¨×ª ××—×“×œ');
      return;
    }
    
    const { data, error } = await supabase
      .from('recipes')
      .select('item_key, prep_time_minutes');
    
    if (error) throw error;
    
    // ×©××™×¨×” ×‘××™×¤×•×™
    if (data) {
      data.forEach(function(recipe) {
        recipePrepTimes[recipe.item_key] = recipe.prep_time_minutes;
      });
    }
    
    console.log('âœ… ×–×× ×™ ×”×›× ×” × ×˜×¢× ×•:', Object.keys(recipePrepTimes).length, '×¤×¨×™×˜×™×');
  } catch (err) {
    console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×–×× ×™ ×”×›× ×”:', err);
  }
}

// ×¤×•× ×§×¦×™×” ×œ×§×‘×œ×ª ×–××Ÿ ×”×›× ×” ×œ×¤×¨×™×˜
function getItemPrepTime(itemKey) {
  return recipePrepTimes[itemKey] || 10; // ×‘×¨×™×¨×ª ××—×“×œ: 10 ×“×§×•×ª
}

// ×—×™×©×•×‘ ×–××Ÿ ×”×›× ×” ×›×•×œ×œ ×œ×”×–×× ×”
function calculateOrderPrepTime(items) {
  let totalMinutes = 0;
  
  for (let key in items) {
    const quantity = items[key];
    const prepTimePerItem = getItemPrepTime(key);
    totalMinutes += prepTimePerItem * quantity;
  }
  
  return totalMinutes;
}
    // ========================================
    // ×™×¦×™×¨×ª ×©×¢×•×ª ××™×¡×•×£ ×—×›××•×ª
    // ========================================

function generatePickupSlots() {
  const select = document.getElementById('pickup-time');
  select.innerHTML = '<option value="">×‘×—×¨ ×©×¢×”</option>';

  const start = 19 * 60; // 19:00
  const end = 22.5 * 60; // 22:30
  
  // ×—×™×©×•×‘ ×–××Ÿ ×”×”×›× ×” ×©×œ ×”×”×–×× ×” ×”× ×•×›×—×™×ª
  const currentOrderPrepTime = calculateOrderPrepTime(orderItems);
  
  // ×™×¦×™×¨×ª ×›×œ ×”×©×¢×•×ª ×”××¤×©×¨×™×•×ª
  for (let minutes = start; minutes <= end; minutes += 5) {
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    const timeStr = hours.toString().padStart(2,'0') + ':' + mins.toString().padStart(2,'0');
    
    // ×‘×“×™×§×” ×× ×”×©×¢×” ×”×–×• ×ª×ª× ×’×© ×¢× ×”×–×× ×•×ª ×§×™×™××•×ª
    let hasConflict = false;
    
    existingOrders.forEach(function(order) {
      try {
        const items = typeof order.items === 'string' ? JSON.parse(order.items) : order.items;
        const existingPrepTime = calculateOrderPrepTime(items);
        
        const timeParts = order.pickup_time.split(':');
        const existingHours = parseInt(timeParts[0]);
        const existingMinutes = parseInt(timeParts[1]);
        const existingTime = existingHours * 60 + existingMinutes;
        
        // ×˜×•×•×— ×”×”×›× ×” ×©×œ ×”×”×–×× ×” ×”×§×™×™××ª
        const existingStart = existingTime - existingPrepTime;
        const existingEnd = existingTime;
        
        // ×˜×•×•×— ×”×”×›× ×” ×©×œ ×”×”×–×× ×” ×”×—×“×©×” (×× ×‘×•×—×¨×™× ××ª ×”×©×¢×” ×”×–×•)
        const newStart = minutes - currentOrderPrepTime;
        const newEnd = minutes;
        
        // ×‘×“×™×§×ª ×”×ª× ×’×©×•×ª
        // ×™×© ×”×ª× ×’×©×•×ª ××:
        // 1. ×”×”×ª×—×œ×” ×©×œ ×”×—×“×© ×‘×˜×•×•×— ×©×œ ×”×§×™×™×
        // 2. ×”×¡×™×•× ×©×œ ×”×—×“×© ×‘×˜×•×•×— ×©×œ ×”×§×™×™×
        // 3. ×”×—×“×© ××›×¡×” ××ª ×›×œ ×”×§×™×™×
        if (
          (newStart >= existingStart && newStart <= existingEnd) || // ×”×ª×—×œ×” ×‘×ª×•×š
          (newEnd >= existingStart && newEnd <= existingEnd) ||     // ×¡×™×•× ×‘×ª×•×š
          (newStart <= existingStart && newEnd >= existingEnd)      // ××›×¡×” ×œ×’××¨×™
        ) {
          hasConflict = true;
          console.log('âŒ ×”×ª× ×’×©×•×ª: ' + timeStr + ' ××ª× ×’×© ×¢× ' + order.pickup_time);
        }
        
      } catch (e) {
        console.error('×©×’×™××” ×‘×‘×“×™×§×ª ×”×ª× ×’×©×•×ª:', e);
      }
    });
    
    // ×”×•×¡×¤×ª ×”××•×¤×¦×™×” ×¨×§ ×× ××™×Ÿ ×”×ª× ×’×©×•×ª
    if (!hasConflict) {
      const option = document.createElement('option');
      option.value = timeStr;
      option.textContent = timeStr;
      select.appendChild(option);
    }
  }
}
    // ========================================
    // ×¡×™×›×•× ×”×–×× ×”
    // ========================================

function updateSummary() {
  let totalRolls = 0;
  let totalPrice = 0;
  let lines = [];

  // ×¨×•×œ×™×
  Object.keys(orderItems).forEach(function(key) {
    const qty = orderItems[key];
    totalRolls += qty;
    
    const parts = key.split('_');
    const category = parts[0];
    const idx = parseInt(parts[1]);
    const item = menuData[category][idx];
    const itemTotal = item.price * qty;
    totalPrice += itemTotal;
    
    lines.push(item.name + ' x' + qty + ' = ' + itemTotal + 'â‚ª');
  });

  // ×¨×˜×‘×™×
  let totalSauces = 0;
  let saucesList = [];

  for (let key in sauceSelections) {
    const qty = sauceSelections[key];
    if (qty > 0) {
      totalSauces += qty;
      const idx = parseInt(key.split('_')[1]);
      const sauceName = menuData.sauces[idx].name;
      saucesList.push(sauceName + ' x' + qty);
    }
  }

  const freeSauces = totalRolls * 2;
  const extraSauces = Math.max(0, totalSauces - freeSauces);
  const saucePrice = extraSauces * 3;
  totalPrice += saucePrice;

  if (totalSauces > 0) {
    lines.push('\n×¨×˜×‘×™×:');
    for (let i = 0; i < saucesList.length; i++) {
      lines.push('  â€¢ ' + saucesList[i]);
    }
    lines.push('×¡×”"×›: ' + totalSauces + ' (' + freeSauces + ' ×—×™× ×, ' + extraSauces + ' ×‘×ª×©×œ×•×) = ' + saucePrice + 'â‚ª');
  }

  // ×¦'×•×¤×¡×˜×™×§×¡
  lines.push('\n×¦\'×•×¤×¡×˜×™×§×¡: ' + chopsticksCount);

  // ×”×¢×¨×•×ª
  const notesInput = document.getElementById('notes');
  if (notesInput) {
    const notes = notesInput.value.trim();
    if (notes) {
      lines.push('\n×”×¢×¨×•×ª: ' + notes);
    }
  }

  // ×©×¢×ª ××™×¡×•×£
  const pickupTimeSelect = document.getElementById('pickup-time');
  const pickupTime = pickupTimeSelect ? pickupTimeSelect.value : '';
  if (pickupTime) {
    lines.push('\n×©×¢×ª ××™×¡×•×£: ' + pickupTime);
  }

  // ×¡×”"×›
  lines.push('\n' + '='.repeat(30) + '\n×¡×”"×› ×œ×ª×©×œ×•×: ' + totalPrice + 'â‚ª');

  // ×¢×“×›×•×Ÿ ×”×ª×¦×•×’×”
  const summaryElement = document.getElementById('order-summary');
  if (summaryElement) {
    summaryElement.textContent = totalRolls > 0 ? lines.join('\n') : '×”×–×× ×” ×¨×™×§×” â€” ×‘×—×¨ ×¨×•×œ×™×, ×¨×˜×‘×™× ×•×©×¢×” ×œ×”×¦×’×ª ×”×¡×™×›×•×.';
  }

  // ×‘×“×™×§×ª ××’×‘×œ×•×ª ×•×”×¤×¢×œ×ª ×›×¤×ª×•×¨
  const sendBtn = document.getElementById('send-order');
  if (!sendBtn) {
    console.error('âŒ ×›×¤×ª×•×¨ ×©×œ×™×—×” ×œ× × ××¦×');
    return;
  }

  console.log('ğŸ”¢ ×¡×”"×› ×¨×•×œ×™×:', totalRolls, '| ×©×¢×”:', pickupTime);

  if (totalRolls === 0) {
    sendBtn.disabled = true;
    sendBtn.style.opacity = '0.5';
    sendBtn.style.cursor = 'not-allowed';
    console.log('âŒ ××™×Ÿ ×¨×•×œ×™×');
  } else if (!pickupTime) {
    sendBtn.disabled = true;
    sendBtn.style.opacity = '0.5';
    sendBtn.style.cursor = 'not-allowed';
    console.log('âŒ ××™×Ÿ ×©×¢×ª ××™×¡×•×£');
  } else if (totalRolls > 15) {
    sendBtn.disabled = true;
    sendBtn.style.opacity = '0.5';
    sendBtn.style.cursor = 'not-allowed';
    showMessage('×œ× × ×™×ª×Ÿ ×œ×”×–××™×Ÿ ×™×•×ª×¨ ×Ö¾15 ×¨×•×œ×™× ×‘×™×•×', 'red');
  } else {
    sendBtn.disabled = false;
    sendBtn.style.opacity = '1';
    sendBtn.style.cursor = 'pointer';
    const messagesDiv = document.getElementById('messages');
    if (messagesDiv) {
      messagesDiv.textContent = '';
    }
    console.log('âœ… ×›×¤×ª×•×¨ ××•×¤×¢×œ - ××•×›×Ÿ ×œ×©×œ×™×—×”');
  }
}
    // ========================================
    // ×©×œ×™×—×ª ×”×–×× ×”
    // ========================================
function setupSendOrder() {
  const sendButton = document.getElementById('send-order');
  
  if (!sendButton) {
    console.error('âŒ ×›×¤×ª×•×¨ ×©×œ×— ×”×–×× ×” ×œ× × ××¦× ×‘-setupSendOrder!');
    return;
  }
  
  console.log('âœ… setupSendOrder - ×›×¤×ª×•×¨ × ××¦×');
  
  sendButton.addEventListener('click', async function(e) {
    e.preventDefault(); // ××•× ×¢ ×©×œ×™×—×ª ×˜×•×¤×¡ ×× ×™×©
    console.log('ğŸ¯ × ×œ×—×¥ ×¢×œ ×›×¤×ª×•×¨ ×©×œ×™×—×”');
    
    let orderUser = currentUser;
    
    if (!currentUser) {
      const guestName = prompt('×©× ××œ×:');
      if (!guestName || guestName.trim() === '') {
        showMessage('×—×™×™×‘ ×œ×”×–×™×Ÿ ×©×', 'red');
        return;
      }
      
      const contactInfo = prompt('×”×–×Ÿ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ××• ××™××™×™×œ:');
      if (!contactInfo || contactInfo.trim() === '') {
        showMessage('×—×™×™×‘ ×œ×”×–×™×Ÿ ×¤×¨×˜×™ ×™×¦×™×¨×ª ×§×©×¨', 'red');
        return;
      }
      
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const phoneRegex = /^0(5[0-9]|[2-4]|[8-9])\d{7}$/;
      
      let guestEmail = '';
      let guestPhone = '';
      
      if (emailRegex.test(contactInfo.trim())) {
        guestEmail = contactInfo.trim();
        guestPhone = '×œ× ×¡×•×¤×§';
      } else if (phoneRegex.test(contactInfo.replace(/[-\s]/g, ''))) {
        guestPhone = contactInfo.replace(/[-\s]/g, '');
        guestEmail = 'guest_' + Date.now() + '@temp.com';
      } else {
        showMessage('×¤×•×¨××˜ ×œ× ×ª×§×™×Ÿ! ×”×–×Ÿ ××™××™×™×œ (example@mail.com) ××• ×˜×œ×¤×•×Ÿ (0501234567)', 'red');
        return;
      }
      
      orderUser = {
        name: guestName.trim(),
        phone: guestPhone,
        email: guestEmail
      };
    }

    const pickupTime = document.getElementById('pickup-time').value;
    if (!pickupTime) {
      showMessage('× × ×œ×‘×—×•×¨ ×©×¢×ª ××™×¡×•×£', 'red');
      return;
    }

    let totalRolls = 0;
    for (let key in orderItems) {
      totalRolls += orderItems[key];
    }

    if (totalRolls === 0) {
      showMessage('×¢×œ×™×š ×œ×‘×—×•×¨ ×œ×¤×—×•×ª ×¨×•×œ ××—×“', 'red');
      return;
    }

    if (totalRolls > 15) {
      showMessage('×œ× × ×™×ª×Ÿ ×œ×”×–××™×Ÿ ×™×•×ª×¨ ×Ö¾15 ×¨×•×œ×™× ×‘×™×•×', 'red');
      return;
    }

    try {
      console.log('ğŸ“¦ ××ª×—×™×œ ×œ×©×œ×•×— ×”×–×× ×”...');
      
      let totalSauces = 0;
      for (let key in sauceSelections) {
        totalSauces += sauceSelections[key];
      }

      const freeSauces = totalRolls * 2;
      const extraSauces = Math.max(0, totalSauces - freeSauces);
      
      let totalPrice = 0;
      for (let key in orderItems) {
        const parts = key.split('_');
        const category = parts[0];
        const idx = parseInt(parts[1]);
        const item = menuData[category][idx];
        totalPrice += item.price * orderItems[key];
      }
      totalPrice += extraSauces * 3;

      const summaryText = document.getElementById('order-summary').textContent;

      const orderData = {
        user_name: orderUser.name,
        email: orderUser.email,
        phone: orderUser.phone,
        order_date: new Date().toISOString().split('T')[0],
        pickup_time: pickupTime,
        items: JSON.stringify(orderItems),
        sauces: JSON.stringify(sauceSelections),
        chopsticks: chopsticksCount,
        notes: document.getElementById('notes').value,
        total_price: totalPrice,
        total_rolls: totalRolls,
        items_summary: summaryText
      };

      console.log('ğŸ“‹ × ×ª×•× ×™ ×”×–×× ×”:', orderData);

      if (!supabase) {
        showMessage('Supabase ×œ× ××—×•×‘×¨ - ×‘×“×•×§ ××ª ×”×”×’×“×¨×•×ª', 'red');
        return;
      }

      const result = await supabase.from('Sushi').insert([orderData]);

      if (result.error) throw result.error;
      
      console.log('âœ… × ×©××¨ ×‘-Supabase');

      await fetch(MAKE_WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(orderData)
      });
      
      console.log('âœ… × ×©×œ×— ×œ-Make.com');

      showMessage('âœ… ×”×”×–×× ×” × ×©×œ×—×” ×‘×”×¦×œ×—×”!', 'green');
      
      resetOrder();
      await loadExistingOrders();

    } catch (err) {
      console.error('âŒ ×©×’×™××” ××¤×•×¨×˜×ª:', err);
      showMessage('âŒ ×©×’×™××” ×‘×©×œ×™×—×ª ×”×”×–×× ×”: ' + err.message, 'red');
    }
  });
}

    // ========================================
    // ××™×¤×•×¡ ×”×–×× ×”
    // ========================================

    function resetOrder() {
      orderItems = {};
      sauceSelections = {};
      chopsticksCount = 1;
      
      document.querySelectorAll('.quantity-control input').forEach(input => {
        input.value = 0;
      });
      
      document.getElementById('chopsticks-qty').value = 1;
      document.getElementById('notes').value = '';
      document.getElementById('pickup-time').value = '';
      
      updateSummary();
    }

    // ========================================
    // ×”×•×“×¢×•×ª ×œ××©×ª××©
    // ========================================

    function showMessage(text, color) {
      const msgDiv = document.getElementById('messages');
      msgDiv.textContent = text;
      msgDiv.style.color = color;
      
      setTimeout(() => {
        msgDiv.textContent = '';
      }, 5000);
    }

  </script>
<!-- POPUP HTML -->
<div id="order-popup" class="order-popup" aria-hidden="true" role="dialog" aria-labelledby="order-popup-title" style="display:none">
  <div class="order-popup__backdrop"></div>
  <div class="order-popup__box" role="document">
    <img src="https://i.imgur.com/m6KeXAB.jpeg" alt="×œ×•×’×•" class="order-popup__logo">
    <button class="order-popup__close" id="order-popup-close" aria-label="×¡×’×•×¨">âœ•</button>
    <h2 id="order-popup-title">×©×™××• ×œ×‘!</h2>
    <p id="order-popup-message"></p>

    <label style="display:flex; align-items:center; gap:8px; margin-top:12px; font-size:0.95rem;">
      <input type="checkbox" id="order-popup-dontshow" />
      ××œ ×ª×¨××” ×©×•×‘ ×”×™×•×
    </label>

    <div style="margin-top:16px; text-align:center;">
      <button id="order-popup-ok" class="order-popup__ok">××™×©×•×¨</button>
    </div>
  </div>
</div>

<!-- POPUP CSS -->
<style>
  #order-popup-title{
    margin: 20px 0 0;
}
  
  #order-popup-message{
    margin-top: 5px;
    font-size: 18px;
    text-align: center;
}
.order-popup { position: fixed; inset: 0; z-index: 1200; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
.order-popup__backdrop { position:absolute; inset:0; background: rgba(0,0,0,0.45); backdrop-filter: blur(2px); }
.order-popup__box {
  position: relative;
  max-width: 80vw;
  margin: 10vh auto;
  background: #fff;
  color: #111;
  border-radius: 10px;
  padding: 18px 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.18);
  text-align:center;
}
.order-popup__close {
  position: absolute;
  right: 10px;
  top: 8px;
  border: none;
  background: transparent;
  font-size: 18px;
  cursor: pointer;
}
  
.order-popup label {
  display: flex;
  justify-content: center;      /* ğŸ‘ˆ ××¨×›×– ××ª ×”×¦â€™×§×‘×•×§×¡ ×•×”×˜×§×¡×˜ ×œ×¨×•×—×‘ */
  align-items: center;
  gap: 8px;
  margin-top: 12px;
  font-size: 0.95rem;
}
.order-popup__logo {
  width: 140px;                /* ×’×•×“×œ ×§×˜×Ÿ ×•× ×—××“ */
  height: auto;
  display: block;
  margin: 0 auto 1px auto;   /* ×××•×¨×›×–, ×¢× ×¨×•×•×— ××ª×—×ª */
  border-radius: 6px;         /* ×¤×™× ×•×ª ××¢×˜ ××¢×•×’×œ×•×ª (×œ× ×—×•×‘×”) */
}
.order-popup__ok {
  background: #cb7e3d;
  color: #fff;
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
}
@media (prefers-color-scheme: dark) {
  .order-popup__box { background:#222; color:#eee; box-shadow: 0 10px 30px rgba(0,0,0,0.6); }
  .order-popup__ok { background: #cb7e3d; , font-size: 16px;}
}
</style>

<!-- POPUP JS -->
<script>
(function() {
  const popup = document.getElementById('order-popup');
  const messageEl = document.getElementById('order-popup-message');
  const closeBtn = document.getElementById('order-popup-close');
  const okBtn = document.getElementById('order-popup-ok');
  const dontShowChk = document.getElementById('order-popup-dontshow');

  // ××ª×’×•×¨×¨ ×œ×¤×™ ×ª××¨×™×š (×›×“×™ ×©×”"××œ ×ª×¨××” ×©×•×‘ ×”×™×•×" ×™×—×–×™×§ ×¨×§ ×œ×™×•× ××—×“)
  const todayKey = 'order-popup-hidden-' + new Date().toISOString().slice(0,10);

  function shouldSkip() {
    return localStorage.getItem(todayKey) === '1';
  }

  function showPopup(text) {
    messageEl.textContent = text;
    popup.style.display = 'block';
    popup.setAttribute('aria-hidden', 'false');
    // ×œ××¤×©×¨ ×¡×’×™×¨×” ×¢× Escape
    document.addEventListener('keydown', onKeyDown);
  }

  function hidePopup(saveDontShow) {
    popup.style.display = 'none';
    popup.setAttribute('aria-hidden', 'true');
    document.removeEventListener('keydown', onKeyDown);
    if (saveDontShow && dontShowChk.checked) {
      localStorage.setItem(todayKey, '1');
    }
  }

  function onKeyDown(e) {
    if (e.key === 'Escape') hidePopup(false);
  }

  closeBtn.addEventListener('click', () => hidePopup(true));
  okBtn.addEventListener('click', () => hidePopup(true));

  // ×”×’×™×•×Ÿ ×–××Ÿ/×™×•×
  function checkAndShow() {
    if (shouldSkip()) return;

    const now = new Date();
    const day = now.getDay(); // 0=×©×‘×ª? actually JS: 0=Sunday, 1=Monday, ..., 3=Wednesday
    // ×‘×©×™××•×© ×‘×¢×‘×¨×™×ª: ×™×•× ×¨×‘×™×¢×™ = 3
    const isWednesday = (day === 3);

    if (isWednesday) {
      const hour = now.getHours();
      const minute = now.getMinutes();
      // × ×™×ª×Ÿ ×œ×©× ×•×ª ××ª ×”××¡×’×¨×ª ×œ×¤×™ ×”×¦×•×¨×š; ×›××Ÿ "×¢×“ ×”×©×¢×” 15:00" ×›×•×œ×œ ×¢×“ 14:59:59
      if (hour < 15) {
        showPopup('×”×™×•× ×™×•× ×¨×‘×™×¢×™ â€” × ×™×ª×Ÿ ×œ×‘×¦×¢ ×”×–×× ×•×ª ×¢×“ ×”×©×¢×” 15:00. ×× × ×”×’×™×©×• ××ª ×”×–×× ×ª×›× ×œ×¤× ×™ ××•×¢×“ ×–×”.');
      } else {
        showPopup('×”×™×•× ×™×•× ×¨×‘×™×¢×™, ××š ×›×‘×¨ ×—×œ×¤×” ×”×©×¢×” 15:00 â€” ×”×”×–×× ×•×ª ×”×™×•× × ×¡×’×¨×•.');
      }
    } else {
      showPopup('×”×”×–×× ×•×ª ××ª×§×‘×œ×•×ª ×¨×§ ×‘×™××™ ×¨×‘×™×¢×™');
    }
  }

  // ×”×¤×¢×œ ×œ××—×¨ ×˜×¢×™× ×ª ×”Ö¾DOM
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', checkAndShow);
  } else {
    checkAndShow();
  }

})();
</script>
</body>
</html>
