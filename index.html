<header>
  <div class="logo-title">
    <img src="https://i.imgur.com/m6KeXAB.jpeg" alt="לוגו" class="logo">
    <h1>תפריט רולים — SUSHI</h1>
  </div>
  <div class="auth-inline">
    <button id="login-btn">התחבר</button>
    <button id="profile-btn">פרופיל</button>
    <button id="guest-btn">שלח כאורח</button>
  </div>
</header>

<style>
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  flex-wrap: wrap;
}

.logo-title {
  display: flex;
  align-items: center;
  gap: 12px;
}

.auth-inline {
  display: flex;
  gap: 8px;
  flex-wrap: nowrap;
}

.auth-inline button {
  white-space: nowrap;
  padding: 6px 12px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  background-color: var(--accent);
  color: #fff;
}

@media (max-width: 480px){
  header {
    flex-direction: column;
    align-items: flex-start;
  }
  .auth-inline {
    margin-top: 8px;
    flex-wrap: wrap;
  }
}
</style>

<script>
// --- התחברות / שמירה ב-localStorage ---
let currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');

function updateAuthUI(){
  const loginBtn = document.getElementById('login-btn');
  const profileBtn = document.getElementById('profile-btn');
  const guestBtn = document.getElementById('guest-btn');

  if(currentUser){
    loginBtn.style.display = 'none';
    profileBtn.style.display = 'inline-block';
    guestBtn.style.display = 'none';
  } else {
    loginBtn.style.display = 'inline-block';
    profileBtn.style.display = 'none';
    guestBtn.style.display = 'inline-block';
  }
}

// התחברות באמצעות Google
document.getElementById('login-btn').addEventListener('click', ()=>{
  google.accounts.id.initialize({
    client_id: GOOGLE_CLIENT_ID,
    callback: handleCredentialResponse,
    ux_mode: 'popup'
  });
  google.accounts.id.prompt();
});

function handleCredentialResponse(response){
  const decoded = jwt_decode(response.credential);
  currentUser = {
    name: decoded.name || decoded.given_name || 'Google User',
    email: decoded.email || ''
  };
  localStorage.setItem('currentUser', JSON.stringify(currentUser));
  updateAuthUI();
  alert(`שלום ${currentUser.name}, התחברת בהצלחה!`);
}

// הצגת פרופיל / התנתקות
document.getElementById('profile-btn').addEventListener('click', ()=>{
  const info = `שם: ${currentUser.name}\nמייל: ${currentUser.email}`;
  if(confirm(info + "\n\nלהתנתק?")){
    localStorage.removeItem('currentUser');
    currentUser = null;
    updateAuthUI();
  }
});

// שליחה כאורח
document.getElementById('guest-btn').addEventListener('click', ()=>{
  let phone = '';
  while(!/^05\d{8}$/.test(phone)){
    phone = prompt('הכנס מספר טלפון למשלוח אישור (05XXXXXXXX):');
    if(phone === null) return; // ביטול
    if(!/^05\d{8}$/.test(phone)) alert('פורמט לא חוקי, נסה שוב.');
  }
  alert(`נשלח כאורח עם מספר ${phone}`);
});

// --- אתחול UI עם טעינת הדף ---
window.addEventListener('DOMContentLoaded', ()=>{
  updateAuthUI();
});
</script>
