<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>×ª×¤×¨×™×˜ ×¡×•×©×™</title>
<style>
:root {
    --accent:#7a2a2a;
    --accent-dark:#5e1b1b;
    --muted:#f0f0f0;
    --danger:#d9534f;
    --bg:#fff;
}
* { box-sizing:border-box; margin:0; padding:0; }
body {
    font-family: Arial, Helvetica, sans-serif;
    background: linear-gradient(180deg,#f6f5f4, #efecec);
    direction: rtl;
    color:#222;
}
header {
    text-align:center;
    margin:16px 0;
}
.logo {
    width:128px;
    height:auto;
    border-radius:12px;
    margin-bottom:16px;
}
.user-actions {
    display:flex;
    justify-content:flex-start;
    gap:8px;
    margin-bottom:12px;
}
.btn {
    padding:8px 12px;
    border-radius:8px;
    border:none;
    cursor:pointer;
    font-weight:700;
}
.btn.primary { background:var(--accent); color:#fff; }
.btn.secondary { background:#fff; color:var(--accent); border:1px solid #ddd; }
.menu-tabs {
    display:flex;
    justify-content:center;
    gap:8px;
    flex-wrap:wrap;
    margin-bottom:12px;
}
.tab {
    padding:8px 12px;
    border-radius:8px;
    background:#fff;
    border:1px solid #eee;
    cursor:pointer;
    font-weight:700;
}
.tab.active {
    background:var(--accent);
    color:#fff;
    border-color:var(--accent-dark);
}
main {
    display:flex;
    flex-direction:column;
    gap:16px;
    padding:0 12px;
}
.category-container {
    display:flex;
    flex-direction:column;
    gap:10px;
    padding:6px 0;
}
.roll-card {
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    padding:12px;
    border-radius:10px;
    background:var(--bg);
    box-shadow:0 4px 14px rgba(0,0,0,0.05);
}
.roll-card .info { flex:1; }
.roll-card h3 { margin:0; color:var(--accent); font-size:1.05rem; }
.roll-card p { margin:0; color:#444; font-size:0.92rem; }
.quantity-control { display:flex; align-items:center; gap:8px; }
.quantity-control button {
    width:38px; height:36px; border-radius:8px; border:none; background:#f0c0c0;
    color:var(--accent); font-weight:700; font-size:1.2rem; cursor:pointer;
}
.quantity-control input {
    width:56px; text-align:center; border:1px solid #ddd; padding:6px; border-radius:6px;
}
.panel {
    background:#fff; padding:12px; border-radius:10px; box-shadow:0 4px 14px rgba(0,0,0,0.04);
    margin-bottom:12px;
}
.panel-title { font-weight:800; color:var(--accent); margin-bottom:8px; }
#notes { width:100%; height:100px; padding:8px; border-radius:8px; border:1px solid #ddd; }
#order-summary {
    background:#fafafa; padding:10px; border-radius:8px; min-height:120px;
    white-space:pre-wrap; font-family:"Courier New", monospace;
}
.actions-row { display:flex; gap:8px; margin-top:8px; }
.note { color:#6b6b6b; font-size:0.9rem; margin-top:8px; }
@media(max-width:980px){
    .menu-tabs { flex-wrap:wrap; }
}
</style>
</head>
<body>

<header>
    <div class="user-actions">
        <button id="auth-btn" class="btn primary">×”×ª×—×‘×¨</button>
        <button id="profile-btn" class="btn secondary">×¤×¨×•×¤×™×œ</button>
    </div>
    <img src="https://i.imgur.com/m6KeXAB.jpeg" alt="×œ×•×’×•" class="logo" />
</header>

<nav class="menu-tabs">
    <button class="tab active" data-target="insideout-rolls">Inside-out</button>
    <button class="tab" data-target="maki-rolls">Maki</button>
    <button class="tab" data-target="onigiri-rolls">Onigiri</button>
    <button class="tab" data-target="poke-rolls">Poke</button>
    <button class="tab" data-target="oshizushi-rolls">Oshizushi</button>
</nav>

<main>
<section id="menu-area">
    <div id="insideout-rolls" class="category-container"></div>
    <div id="maki-rolls" class="category-container" style="display:none;"></div>
    <div id="onigiri-rolls" class="category-container" style="display:none;"></div>
    <div id="poke-rolls" class="category-container" style="display:none;"></div>
    <div id="oshizushi-rolls" class="category-container" style="display:none;"></div>
</section>

<aside id="side-area">
    <section class="panel">
        <div class="panel-title">×¨×˜×‘×™×</div>
        <div id="sauces-container" class="category-container"></div>
        <p class="note">×›×œ ×¨×•×œ ××§×‘×œ 2 ×¨×˜×‘×™× ×—×™× ×. ×¨×•×˜×‘ × ×•×¡×£ 3â‚ª.</p>
    </section>

    <section class="panel">
        <div class="panel-title">×›××•×ª ×¦'×•×¤×¡×˜×™×§×¡</div>
        <div class="quantity-control">
            <button id="chopsticks-minus">âˆ’</button>
            <input id="chopsticks-qty" type="number" readonly value="1">
            <button id="chopsticks-plus">+</button>
        </div>
    </section>

    <section class="panel">
        <div class="panel-title">×‘×—×¨ ×©×¢×ª ××™×¡×•×£</div>
        <select id="pickup-time"><option value="">×‘×—×¨ ×©×¢×”</option></select>
        <p class="note small" id="pickup-note"></p>
    </section>

    <section class="panel">
        <div class="panel-title">×”×¢×¨×•×ª ××™×©×™×•×ª</div>
        <textarea id="notes" placeholder="×œ×“×•×’××”: ×œ×œ× ×’×œ×•×˜×Ÿ, ×”×’×¢×” ×‘×©×¢×¨ 3..."></textarea>
    </section>

    <section class="panel">
        <div class="panel-title">×¡×™×›×•× ×”×–×× ×”</div>
        <pre id="order-summary">×”×–×× ×” ×¨×™×§×” â€” ×‘×—×¨ ×¨×•×œ×™×, ×¨×˜×‘×™× ×•×©×¢×” ×œ×”×¦×’×ª ×”×¡×™×›×•×.</pre>
        <div class="actions-row">
            <button id="send-order" class="btn primary">×©×œ×— ×”×–×× ×”</button>
        </div>
    </section>

    <div id="messages" aria-live="polite"></div>
</aside>
</main>

<script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
/* ================= CONFIG ================= */
const SUPABASE_URL = 'https://oxjokdjwdvmmdtcvqvon.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im94am9rZGp3ZHZtbWR0Y3Zxdm9uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwNzgwMzMsImV4cCI6MjA3NDY1NDAzM30.DmKp79UiPi9iOU50UutevdqRcPyREMUJ7NT5ZmBHDsg';
const MAKE_WEBHOOK_URL = 'https://hook.eu2.make.com/asitqrbtyjum10ph3vf6gxhkd766us3r';
const GOOGLE_CLIENT_ID = '962297663657-7bsrugivo5rjbu534lamiuc256gbqoc4.apps.googleusercontent.com';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* ================= STORAGE ================= */
let bookedTimes = JSON.parse(localStorage.getItem('bookedTimes')||'[]');
let dailyRollCount = JSON.parse(localStorage.getItem('dailyRollCount')||'{}');
let currentUser = JSON.parse(localStorage.getItem('currentUser')||'null');
let chopsticksCount = 1;
let selectedRolls = {};
let selectedSauces = {};

/* ================= DATA ================= */
/* ×›××Ÿ ××ª×” ×™×›×•×œ ×œ×”×¢×ª×™×§ ××ª ×›×œ ×”××¢×¨×›×™× ×”××œ××™× ×©×œ ×”×¨×•×œ×™× ×›××• ×‘×§×•×“ ×”×¨××©×•×Ÿ ×©×œ×š */
const insideOutRollsData = [
    {id:"bingo", name:"×¨×•×œ ×‘×™× ×’×• - 50â‚ª", description:"×¡×œ××•×Ÿ × ×, ×©×× ×ª, ××‘×•×§×“×• ×‘×¦×™×¤×•×™ ×©×•××©×•× ×§×œ×•×™", price:50},
    {id:"luna", name:"×¨×•×œ ×œ×•× ×” - 50â‚ª", description:"×¡×¤×™×™×¡×™ ×¡×œ××•×Ÿ ××¤×•×™ ×¢×œ ×¨×•×œ ×‘×˜×˜×”, ××‘×•×§×“×• ×•×©×™×˜××§×™", price:50},
    {id:"belgian", name:"×¨×•×œ ×¨×™×™ - 55â‚ª", description:"×˜×¨×˜×¨ ×¡×¤×™×™×¡×™ ×˜×•× ×” × × ×¢×œ ×¨×•×œ ××œ×¤×¤×•×Ÿ, ×¢×™×¨×™×ª ×•××•×©×™× ×§×•", price:55},
    {id:"crazy-bruno", name:"×¨×•×œ ×§×¨×™×™×–×™ ×‘×¨×•× ×• - 60â‚ª", description:"×“×’ ×œ×‘×Ÿ, ×˜×•× ×”, ×¡×œ××•×Ÿ ×‘×¦×™×¤×•×™ ×©×•××©×•× ×§×œ×•×™", price:60},
    {id:"happy-bruno", name:"×¨×•×œ ×”××¤×™ ×‘×¨×•× ×• - 60â‚ª", description:"×¡×œ××•×Ÿ ×‘×¦×™×¤×•×™ ×©×§×“×™× ×§×œ×•×™×™× ×•×¨×•×˜×‘ ×˜×¨×™××§×™", price:60},
    {id:"mila", name:"×¨×•×œ ××™×œ×” - 50â‚ª", description:"×‘×˜×˜×”, ×¢×™×¨×™×ª ×•××‘×•×§×“×• ×‘×¢×™×˜×•×£ ×¡×œ××•×Ÿ ×¦×¨×•×‘", price:50},
    {id:"newton", name:"×¨×•×œ × ×™×•×˜×•×Ÿ - 55â‚ª", description:"×˜×•× ×” ××“×•××”, ××‘×•×§×“×•, ×‘×˜×˜×” ×‘×¦×™×¤×•×™ ×¤× ×§×• ×•×¨×•×˜×‘ ×‘×•×˜× ×™×", price:55},
    {id:"oli", name:"×¨×•×œ ××•×œ×™ - 50â‚ª", description:"×“×’ ×œ×‘×Ÿ, ××œ×¤×¤×•×Ÿ, ××‘×•×§×“×• ×‘×¦×™×¤×•×™ ×©×•××©×•×", price:50},
    {id:"milli", name:"×¨×•×œ ××™×œ×™ - 50â‚ª", description:"××§×œ ×¡×•×¨×™××™, ×“×’ ×œ×‘×Ÿ ××¤×•×™, ××•×©×™× ×§×• ×‘×¦×™×¤×•×™ ×¤× ×§×•", price:50},
    {id:"scar", name:"×¨×•×œ ×¡×§××¨ - 50â‚ª", description:"×¡×¤×™×™×¡×™ ×¡×œ××•×Ÿ ××¤×•×™ ×¢× ××‘×•×§×“×•, ××œ×¤×¤×•×Ÿ ×•×‘×˜×˜×” ×‘×¢×™×˜×•×¨ ××™×•× ×– ×•×¦â€™×™×¤×¡", price:50},
    {id:"magi", name:"×¨×•×œ ××’×™ğŸŒ± - 40â‚ª", description:"××œ×¤×¤×•×Ÿ, ×‘×˜×˜×”, ×¢×™×¨×™×ª ×•××‘×•×§×“×• ×‘×¢×™×˜×•×¨ ×‘×˜×˜×” ×•×¨×•×˜×‘ ×‘×•×˜× ×™×", price:40},
    {id:"tyson", name:"×¨×•×œ ×˜×™×™×¡×•×Ÿ ×•×§×™×™×œ×” - 50â‚ª", description:"×¡×œ××•×Ÿ × ×, ×§× ×¤×™×•, ×‘×˜×˜×” ×‘×¢×™×˜×•×£ ×©×‘×‘×™ ×¤× ×§×• ×¡×’×•×œ", price:50},
    {id:"lucy", name:"×¨×•×œ ×œ×•×¡×™ - 55â‚ª", description:"×¡×œ××•×Ÿ × ×, ×¤×˜×¨×™×•×ª ×©×™×˜××§×™ ×•××•×©×™× ×§×• ×‘×¦×™×¤×•×™ ×˜×•×‘×™×§×•", price:55},
    {id:"billy", name:"×¨×•×œ ×‘×™×œ×™ - 50â‚ª", description:"×“×’ ×œ×‘×Ÿ ×¦×¨×•×‘, ×¢×™×¨×™×ª, ×‘×˜×˜×” ××¦×•×¤×” ×‘×¤× ×§×•", price:50},
    {id:"lucky", name:"×¨×•×œ ×œ××§×™ - 50â‚ª", description:"×˜×¨×˜×¨ ×¡×¤×™×™×¡×™ ×¡×œ××•×Ÿ ×¢× ××‘×•×§×“×•, ××œ×¤×¤×•×Ÿ ×•×¢×™×¨×™×ª", price:50}
];
const makiRollsData = [
    {id:"alfi", name:"×¨×•×œ ××œ×¤×™ - 35â‚ª", description:"×××§×™ ×¡×œ××•×Ÿ", price:35},
    {id:"maymay", name:"×¨×•×œ ××™×™ ××™×™ğŸŒ± - 25â‚ª", description:"×××§×™ ×‘×˜×˜×” ×•××‘×•×§×“×•", price:25},
    {id:"snoopy", name:"×¨×•×œ ×¡× ×•×¤×™ğŸŒ± - 25â‚ª", description:"×××§×™ ××•×©×™× ×§×• ×•×§× ×¤×™×•", price:25}
];
const onigiriData = [
    {id:"rocky", name:"××•× ×™×’×™×¨×™ ×¨×•×§×™ - 35â‚ª", description:"×˜×¨×˜×¨ ×˜×•× ×” ××“×•××” ×¢× ×¡×¤×™×™×¡×™ ××™×•× ×– ×•×‘×¦×œ ×™×¨×•×§", price:35},
    {id:"johnny", name:"××•× ×™×’×™×¨×™ ×’×³×•× ×™ - 30â‚ª", description:"×˜×¨×˜×¨ ×¡×œ××•×Ÿ ×¢× ×¡×¤×™×™×¡×™ ××™×•× ×– ×•×‘×¦×œ ×™×¨×•×§", price:30},
    {id:"gisel", name:"××•× ×™×’×™×¨×™ ×’×³×™×–×œğŸŒ± - 25â‚ª", description:"××‘×•×§×“×• ×•×‘×˜×˜×”", price:25}
];
const pokeData = [
    {id:"dog", name:"×‘×•×œ-×“×•×’ - 60â‚ª", description:"××•×¨×– ×¡×•×©×™, ×¡×œ××•×Ÿ ×‘××¨×™× ×“×”, ××“×××”, ××œ×¤×¤×•×Ÿ, ××‘×•×§×“×•, ×‘×¦×œ ×™×¨×•×§. ××¢×œ ×©×•××©×•× ×•×¨×•×˜×‘ ×¡×¤×™×™×¡×™ ××™×•× ×–", price:60},
    {id:"pit", name:"×¤×™×˜-×‘×•×œ - 70â‚ª", description:"××•×¨×– ×¡×•×©×™, ×˜×•× ×” ×‘××¨×™× ×“×”, ××“×××”, ×× ×’×•, ×›×¨×•×‘ ×¡×’×•×œ, ×¤×˜×¨×™×•×ª ×©×™×˜××§×™. ××¢×œ ×‘×¦×œ ×©××œ×•×˜ ××˜×•×’×Ÿ ×•×¨×•×˜×‘ ×× × ×¡ ××ª×•×§", price:70},
    {id:"trir", name:"×‘×•×œ-×˜×¨×™×™×¨ğŸŒ± - 45â‚ª", description:"××•×¨×– ×¡×•×©×™, ××“×××”, ××œ×¤×¤×•×Ÿ, ×¤×˜×¨×™×•×ª ×©×™×˜××§×™, ×’×–×¨ ×•××‘×•×§×“×•. ××¢×œ ×©×•××©×•× ×•×¨×•×˜×‘ ×‘×•×˜× ×™×", price:45}
];
const oshizushiData = [
    {id:"oshi1", name:"××•×©×™ ×¡×•×©×™ 1 - 60â‚ª", description:"××•×©×™ ×¢× ×¡×œ××•×Ÿ, ××‘×•×§×“×• ×•×¨×•×˜×‘ ×˜×¨×™××§×™", price:60},
    {id:"oshi2", name:"××•×©×™ ×¡×•×©×™ 2 - 55â‚ª", description:"××•×©×™ ×¢× ×˜×•× ×”, ××œ×¤×¤×•×Ÿ ×•×©×•××©×•×", price:55}
];
const saucesData = [
    {id:"spicy-mayo", name:"×¡×¤×™×™×¡×™ ××™×•× ×–", price:3},
    {id:"soy", name:"×¨×•×˜×‘ ×¡×•×™×”", price:3},
    {id:"teriyaki", name:"×¨×•×˜×‘ ×˜×¨×™××§×™", price:3},
    {id:"ginger", name:"×’×³×™× ×’×³×¨", price:3},
    {id:"wasabi", name:"×•×•××¡××‘×™", price:3}
];

/* ================= HELPERS ================= */
function $id(id){ return document.getElementById(id); }
function formatPrice(price){ return price+'â‚ª'; }
function createRollCard(roll, container){
    const card = document.createElement('div');
    card.className = 'roll-card';
    const info = document.createElement('div');
    info.className = 'info';
    info.innerHTML = `<h3>${roll.name}</h3><p>${roll.description}</p><p>××—×™×¨: ${formatPrice(roll.price)}</p>`;
    const qtyControl = document.createElement('div');
    qtyControl.className='quantity-control';
    qtyControl.innerHTML=`<button>-</button><input type="number" readonly value="0"><button>+</button>`;
    qtyControl.querySelector('button:first-child').onclick = ()=>{
        let val = parseInt(qtyControl.querySelector('input').value);
        if(val>0){ qtyControl.querySelector('input').value = val-1; selectedRolls[roll.id]=val-1; updateSummary(); }
    };
    qtyControl.querySelector('button:last-child').onclick = ()=>{
        let val = parseInt(qtyControl.querySelector('input').value);
        qtyControl.querySelector('input').value = val+1; selectedRolls[roll.id]=val+1; updateSummary();
    };
    card.appendChild(info);
    card.appendChild(qtyControl);
    container.appendChild(card);
}

/* ================= INIT ================= */
function initMenu(){
    const mappings = [
        {data:insideOutRollsData, container:$id('insideout-rolls')},
        {data:makiRollsData, container:$id('maki-rolls')},
        {data:onigiriData, container:$id('onigiri-rolls')},
        {data:pokeData, container:$id('poke-rolls')},
        {data:oshizushiData, container:$id('oshizushi-rolls')}
    ];
    mappings.forEach(map=>{
        map.data.forEach(r=> createRollCard(r,map.container));
    });
    // sauces
    const saucesContainer = $id('sauces-container');
    saucesData.forEach(s=>{
        const span = document.createElement('span');
        span.textContent=s.name;
        saucesContainer.appendChild(span);
    });
}
function updateSummary(){
    let summary='×”×–×× ×”:\n';
    for(let id in selectedRolls){
        if(selectedRolls[id]>0){
            let roll = [...insideOutRollsData,...makiRollsData,...onigiriData,...pokeData,...oshizushiData].find(r=>r.id===id);
            summary += `${roll.name} x ${selectedRolls[id]} = ${roll.price*selectedRolls[id]}â‚ª\n`;
        }
    }
    summary += `\n××¡×¤×¨ ×¦'×•×¤×¡×˜×™×§×¡: ${chopsticksCount}`;
    summary += `\n×”×¢×¨×•×ª: ${$id('notes').value}`;
    $id('order-summary').textContent = summary;
}
function initTabs(){
    document.querySelectorAll('.tab').forEach(tab=>{
        tab.onclick=()=>{
            document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
            tab.classList.add('active');
            document.querySelectorAll('.category-container').forEach(c=>c.style.display='none');
            $id(tab.dataset.target).style.display='flex';
        }
    });
}
function initPickupTimes(){
    const select = $id('pickup-time');
    for(let h=19;h<=22;h++){
        let mMax = h===22?30:59;
        for(let m=0;m<=mMax;m+=30){
            let val = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
            let opt = document.createElement('option'); opt.value=val; opt.textContent=val;
            select.appendChild(opt);
        }
    }
}

/* ================= AUTH ================= */
$id('auth-btn').onclick = ()=>{
    google.accounts.id.initialize({client_id: GOOGLE_CLIENT_ID, callback: handleCredentialResponse});
    google.accounts.id.prompt();
};
function handleCredentialResponse(response){
    const user = jwt_decode(response.credential);
    currentUser = {id:user.sub, name:user.name, email:user.email};
    localStorage.setItem('currentUser',JSON.stringify(currentUser));
    $id('auth-btn').style.display='none';
    $id('profile-btn').style.display='inline-block';
}
$id('profile-btn').onclick=()=>{ alert('×¤×¨×•×¤×™×œ ××©×ª××©: '+currentUser?.name); };

/* ================= CHOPSTICKS ================= */
$id('chopsticks-plus').onclick = ()=>{ chopsticksCount++; $id('chopsticks-qty').value=chopsticksCount; updateSummary(); }
$id('chopsticks-minus').onclick = ()=>{ if(chopsticksCount>1){ chopsticksCount--; $id('chopsticks-qty').value=chopsticksCount; updateSummary(); }}

/* ================= SEND ORDER ================= */
$id('send-order').onclick = async ()=>{
    if(!currentUser){ alert('×™×© ×œ×”×ª×—×‘×¨ ×œ×¤× ×™ ×©×œ×™×—×ª ×”×–×× ×”'); return; }
    if(Object.values(selectedRolls).every(v=>v===0)){ alert('×™×© ×œ×‘×—×•×¨ ×¨×•×œ×™× ×œ×¤× ×™ ×©×œ×™×—×ª ×”×–×× ×”'); return; }
    if(!$id('pickup-time').value){ alert('×™×© ×œ×‘×—×•×¨ ×©×¢×ª ××™×¡×•×£'); return; }

    const payload = {
        user: currentUser,
        rolls:selectedRolls,
        sauces:selectedSauces,
        chopsticks:chopsticksCount,
        notes:$id('notes').value,
        pickup:$id('pickup-time').value
    };
    try{
        await fetch(MAKE_WEBHOOK_URL,{method:'POST',body:JSON.stringify(payload)});
        $id('messages').textContent='×”×”×–×× ×” × ×©×œ×—×” ×‘×”×¦×œ×—×”!';
    }catch(e){ console.error(e); $id('messages').textContent='×©×’×™××” ×‘×©×œ×™×—×ª ×”×”×–×× ×”.'; }
};

/* ================= INIT ================= */
initMenu();
initTabs();
initPickupTimes();
updateSummary();
</script>
</body>
</html>
