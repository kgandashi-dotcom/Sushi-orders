<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>×¡×•×©×™ ×‘×¨ - ×”×–×× ×•×ª</title>
<style>
:root {
    --accent:#7a2a2a; 
    --accent-dark:#5e1b1b; 
    --muted:#f0f0f0; 
    --danger:#d9534f; 
    --bg:#fff;
}

*{box-sizing:border-box;}
body{margin:0;font-family:Arial, Helvetica, sans-serif;background:linear-gradient(180deg,#f6f5f4,#efecec);direction:rtl;color:#222;}
.container{max-width:1200px;margin:16px auto;padding:14px;background: rgba(255,255,255,0.94);border-radius:12px;box-shadow:0 8px 26px rgba(0,0,0,0.08);}

/* Header */
header{text-align:center;margin-bottom:12px;}
.logo{width:120px;height:auto;margin:0 auto 12px auto;display:block;border-radius:8px;}
.user-actions{display:flex;justify-content:flex-start;gap:8px;margin-bottom:12px;}
.btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700;}
.btn.primary{background:var(--accent);color:#fff;}
.btn.secondary{background:#fff;color:var(--accent);border:1px solid #ddd;}
.btn.danger{background:#b71c1c;color:#fff;}
.btn.plain{background:transparent;color:#555;border:1px solid #eee;}

/* Tabs */
.menu-tabs{display:flex;gap:8px;justify-content:center;margin-bottom:16px;}
.tab{padding:8px 12px;border-radius:8px;background:#fff;border:1px solid #eee;cursor:pointer;font-weight:700;}
.tab.active{background:var(--accent);color:#fff;border-color:var(--accent-dark);}

/* Layout main */
main{display:flex;flex-direction:column;gap:18px;}
#menu-area{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;}
.category-container{display:flex;flex-direction:column;gap:10px;padding:6px 0;}
.roll-card{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:12px;border-radius:10px;background:var(--bg);box-shadow:0 4px 14px rgba(0,0,0,0.05);}
.roll-card .info{flex:1 1 auto;}
.roll-card h3{margin:0;color:var(--accent);font-size:1.02rem;}
.roll-card p{margin:0;color:#444;font-size:0.92rem;}
.quantity-control{display:flex;align-items:center;gap:8px;}
.quantity-control button{width:38px;height:36px;border-radius:8px;border:none;background:#f0c0c0;color:var(--accent);font-weight:700;font-size:1.2rem;cursor:pointer;}
.quantity-control input{width:56px;text-align:center;border:1px solid #ddd;padding:6px;border-radius:6px;}

/* Panels */
.panel{background:#fff;padding:12px;border-radius:10px;box-shadow:0 4px 14px rgba(0,0,0,0.04);margin-bottom:12px;}
.panel-title{font-weight:800;color:var(--accent);margin-bottom:8px;}
#notes{width:100%;min-height:80px;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:1rem;}

/* Summary */
#order-summary{background:#fafafa;padding:10px;border-radius:8px;min-height:150px;white-space:pre-wrap;font-family:"Courier New", monospace;}
.actions-row{display:flex;gap:8px;margin-top:8px;}
.note{color:#6b6b6b;font-size:0.9rem;margin-top:8px;}

/* Messages */
#messages{margin-top:8px;color:var(--danger);font-weight:700;}

/* Modals */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.35);z-index:40;padding:12px;}
.modal .modal-content{background:#fff;padding:16px;border-radius:10px;width:100%;max-width:520px;box-shadow:0 10px 30px rgba(0,0,0,0.2);}
.modal .modal-content h3{margin:0 0 8px 0;}
.modal label{display:block;margin:8px 0;}
.modal input, .modal textarea, .modal select{width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;}

/* Responsive */
@media(max-width:980px){
    #menu-area{flex-direction:column;align-items:center;}
    .quantity-control input{width:48px;}
}
</style>
</head>
<body>
<div class="container">
<header>
    <img src="https://i.imgur.com/m6KeXAB.jpeg" alt="×œ×•×’×•" class="logo">
    <div class="user-actions">
        <button id="profile-btn" class="btn primary">×”×ª×—×‘×¨</button>
    </div>
    <nav class="menu-tabs" role="navigation" aria-label="×ª×¤×¨×™×˜ ×§×˜×’×•×¨×™×•×ª">
        <button class="tab active" data-target="insideout-rolls">Inside-out</button>
        <button class="tab" data-target="maki-rolls">Maki</button>
        <button class="tab" data-target="onigiri-rolls">Onigiri</button>
        <button class="tab" data-target="poke-rolls">Poke</button>
        <button class="tab" data-target="oshizushi-rolls">Oshizushi</button>
    </nav>
</header>

<main>
<section id="menu-area">
    <div id="insideout-rolls" class="category-container"></div>
    <div id="maki-rolls" class="category-container" style="display:none"></div>
    <div id="onigiri-rolls" class="category-container" style="display:none"></div>
    <div id="poke-rolls" class="category-container" style="display:none"></div>
    <div id="oshizushi-rolls" class="category-container" style="display:none"></div>
</section>

<aside id="side-area">
    <section id="sauces-section" class="panel">
        <div class="panel-title">×¨×˜×‘×™×</div>
        <div id="sauces-container" class="category-container"></div>
        <p class="note">×›×œ ×¨×•×œ ××§×‘×œ 2 ×¨×˜×‘×™× ×—×™× ×. ×¨×•×˜×‘ × ×•×¡×£ 3â‚ª.</p>
    </section>

    <section class="panel">
        <div class="panel-title">×›××•×ª ×¦'×•×¤×¡×˜×™×§×¡</div>
        <div class="quantity-control">
            <button id="chopsticks-minus">âˆ’</button>
            <input id="chopsticks-qty" type="number" readonly value="1">
            <button id="chopsticks-plus">+</button>
        </div>
    </section>

    <section class="panel">
        <div class="panel-title">×‘×—×¨ ×©×¢×ª ××™×¡×•×£</div>
        <select id="pickup-time"><option value="">×‘×—×¨ ×©×¢×”</option></select>
    </section>

    <section class="panel">
        <div class="panel-title">×”×¢×¨×•×ª ××™×©×™×•×ª</div>
        <textarea id="notes" placeholder="×œ×“×•×’××”: ×œ×œ× ×’×œ×•×˜×Ÿ, ×”×’×¢×” ×‘×©×¢×¨ 3..."></textarea>
    </section>

    <section class="panel">
        <div class="panel-title">×¡×™×›×•× ×”×–×× ×”</div>
        <pre id="order-summary">×”×–×× ×” ×¨×™×§×” â€” ×‘×—×¨ ×¨×•×œ×™×, ×¨×˜×‘×™× ×•×©×¢×” ×œ×”×¦×’×ª ×”×¡×™×›×•×.</pre>
        <div class="actions-row">
            <button id="send-order" class="btn primary" disabled>×©×œ×— ×”×–×× ×”</button>
        </div>
    </section>
    <div id="messages" aria-live="polite"></div>
</aside>
</div>

<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://cdn.jsdelivr.net/npm/jwt-decode@3/build/jwt-decode.min.js"></script>
<script>
/* ================== CONFIG ================== */
const SUPABASE_URL = 'https://oxjokdjwdvmmdtcvqvon.supabase.co';
const SUPABASE_KEY = 'YOUR_SUPABASE_KEY';
const MAKE_WEBHOOK_URL = 'https://hook.eu2.make.com/asitqrbtyjum10ph3vf6gxhkd766us3r';
const GOOGLE_CLIENT_ID = '962297663657-7bsrugivo5rjbu534lamiuc256gbqoc4.apps.googleusercontent.com';
const supabase = window.supabase ? window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY) : null;

/* ================== STATE ================== */
let bookedTimes = JSON.parse(localStorage.getItem('bookedTimes')||'[]');
let dailyRollCount = JSON.parse(localStorage.getItem('dailyRollCount')||'{}');
let currentUser = JSON.parse(localStorage.getItem('currentUser')||'null');
let chopsticksCount=1;
let selectedRolls={};
let selectedSauces={};

/* ================== MENU DATA ================== */
const insideOutRollsData = [
  {id:"bingo",name:"×¨×•×œ ×‘×™× ×’×• - 50â‚ª",description:"×¡×œ××•×Ÿ × ×, ×©×× ×ª, ××‘×•×§×“×• ×‘×¦×™×¤×•×™ ×©×•××©×•× ×§×œ×•×™",price:50},
  {id:"luna",name:"×¨×•×œ ×œ×•× ×” - 50â‚ª",description:"×¡×¤×™×™×¡×™ ×¡×œ××•×Ÿ ××¤×•×™ ×¢×œ ×¨×•×œ ×‘×˜×˜×”, ××‘×•×§×“×• ×•×©×™×˜××§×™",price:50},
  {id:"belgian",name:"×¨×•×œ ×¨×™×™ - 55â‚ª",description:"×˜×¨×˜×¨ ×¡×¤×™×™×¡×™ ×˜×•× ×” × × ×¢×œ ×¨×•×œ ××œ×¤×¤×•×Ÿ, ×¢×™×¨×™×ª ×•××•×©×™× ×§×•",price:55},
  {id:"crazy-bruno",name:"×¨×•×œ ×§×¨×™×™×–×™ ×‘×¨×•× ×• - 60â‚ª",description:"×“×’ ×œ×‘×Ÿ, ×˜×•× ×”, ×¡×œ××•×Ÿ ×‘×¦×™×¤×•×™ ×©×•××©×•× ×§×œ×•×™",price:60},
  {id:"happy-bruno",name:"×¨×•×œ ×”××¤×™ ×‘×¨×•× ×• - 60â‚ª",description:"×¡×œ××•×Ÿ ×‘×¦×™×¤×•×™ ×©×§×“×™× ×§×œ×•×™×™× ×•×¨×•×˜×‘ ×˜×¨×™××§×™",price:60},
  {id:"mila",name:"×¨×•×œ ××™×œ×” - 50â‚ª",description:"×‘×˜×˜×”, ×¢×™×¨×™×ª ×•××‘×•×§×“×• ×‘×¢×™×˜×•×£ ×¡×œ××•×Ÿ ×¦×¨×•×‘",price:50},
  {id:"newton",name:"×¨×•×œ × ×™×•×˜×•×Ÿ - 55â‚ª",description:"×˜×•× ×” ××“×•××”, ××‘×•×§×“×•, ×‘×˜×˜×” ×‘×¦×™×¤×•×™ ×¤× ×§×• ×•×¨×•×˜×‘ ×‘×•×˜× ×™×",price:55},
  {id:"oli",name:"×¨×•×œ ××•×œ×™ - 50â‚ª",description:"×“×’ ×œ×‘×Ÿ, ××œ×¤×¤×•×Ÿ, ××‘×•×§×“×• ×‘×¦×™×¤×•×™ ×©×•××©×•×",price:50},
  {id:"milli",name:"×¨×•×œ ××™×œ×™ - 50â‚ª",description:"××§×œ ×¡×•×¨×™××™, ×“×’ ×œ×‘×Ÿ ××¤×•×™, ××•×©×™× ×§×• ×‘×¦×™×¤×•×™ ×¤× ×§×•",price:50},
  {id:"scar",name:"×¨×•×œ ×¡×§××¨ - 50â‚ª",description:"×¡×¤×™×™×¡×™ ×¡×œ××•×Ÿ ××¤×•×™ ×¢× ××‘×•×§×“×•, ××œ×¤×¤×•×Ÿ ×•×‘×˜×˜×” ×‘×¢×™×˜×•×¨ ××™×•× ×– ×•×¦â€™×™×¤×¡",price:50},
  {id:"magi",name:"×¨×•×œ ××’×™ğŸŒ± - 40â‚ª",description:"××œ×¤×¤×•×Ÿ, ×‘×˜×˜×”, ×¢×™×¨×™×ª ×•××‘×•×§×“×• ×‘×¢×™×˜×•×¨ ×‘×˜×˜×” ×•×¨×•×˜×‘ ×‘×•×˜× ×™×",price:40},
  {id:"tyson",name:"×¨×•×œ ×˜×™×™×¡×•×Ÿ ×•×§×™×™×œ×” - 50â‚ª",description:"×¡×œ××•×Ÿ × ×, ×§× ×¤×™×•, ×‘×˜×˜×” ×‘×¢×™×˜×•×£ ×©×‘×‘×™ ×¤× ×§×• ×¡×’×•×œ",price:50},
  {id:"lucy",name:"×¨×•×œ ×œ×•×¡×™ - 55â‚ª",description:"×¡×œ××•×Ÿ × ×, ×¤×˜×¨×™×•×ª ×©×™×˜××§×™ ×•××•×©×™× ×§×• ×‘×¦×™×¤×•×™ ×˜×•×‘×™×§×•",price:55},
  {id:"billy",name:"×¨×•×œ ×‘×™×œ×™ - 50â‚ª",description:"×“×’ ×œ×‘×Ÿ ×¦×¨×•×‘, ×¢×™×¨×™×ª, ×‘×˜×˜×” ××¦×•×¤×” ×‘×¤× ×§×•",price:50},
  {id:"lucky",name:"×¨×•×œ ×œ××§×™ - 50â‚ª",description:"×˜×¨×˜×¨ ×¡×¤×™×™×¡×™ ×¡×œ××•×Ÿ ×¢× ××‘×•×§×“×•, ××œ×¤×¤×•×Ÿ ×•×¢×™×¨×™×ª",price:50}
];

const makiRollsData = [
  {id:"alfi",name:"×¨×•×œ ××œ×¤×™ - 35â‚ª",description:"×××§×™ ×¡×œ××•×Ÿ",price:35},
  {id:"maymay",name:"×¨×•×œ ××™×™ ××™×™ğŸŒ± - 25â‚ª",description:"×××§×™ ×‘×˜×˜×” ×•××‘×•×§×“×•",price:25},
  {id:"snoopy",name:"×¨×•×œ ×¡× ×•×¤×™ğŸŒ± - 25â‚ª",description:"×××§×™ ××•×©×™× ×§×• ×•×§× ×¤×™×•",price:25}
];

const onigiriData = [
  {id:"rocky",name:"××•× ×™×’×™×¨×™ ×¨×•×§×™ - 35â‚ª",description:"×˜×¨×˜×¨ ×˜×•× ×” ××“×•××” ×¢× ×¡×¤×™×™×¡×™ ××™×•× ×– ×•×‘×¦×œ ×™×¨×•×§",price:35},
  {id:"johnny",name:"××•× ×™×’×™×¨×™ ×’×³×•× ×™ - 30â‚ª",description:"×˜×¨×˜×¨ ×¡×œ××•×Ÿ ×¢× ×¡×¤×™×™×¡×™ ××™×•× ×– ×•×‘×¦×œ ×™×¨×•×§",price:30},
  {id:"gisel",name:"××•× ×™×’×™×¨×™ ×’×³×™×–×œğŸŒ± - 25â‚ª",description:"××‘×•×§×“×• ×•×‘×˜×˜×”",price:25}
];

const pokeData = [
  {id:"dog",name:"×‘×•×œ-×“×•×’ - 60â‚ª",description:"××•×¨×– ×¡×•×©×™, ×¡×œ××•×Ÿ ×‘××¨×™× ×“×”, ××“×××”, ××œ×¤×¤×•×Ÿ, ××‘×•×§×“×•, ×‘×¦×œ ×™×¨×•×§. ××¢×œ ×©×•××©×•× ×•×¨×•×˜×‘ ×˜×¨×™××§×™",price:60},
  {id:"cat",name:"×§××˜-×‘×•×œ - 60â‚ª",description:"××•×¨×– ×¡×•×©×™, ×˜×•× ×” × ×, ××“×××”, ××œ×¤×¤×•×Ÿ, ××‘×•×§×“×•, ×‘×¦×œ ×™×¨×•×§. ××¢×œ ×©×•××©×•× ×•×¨×•×˜×‘ ×¡×•×™×”",price:60}
];

const oshizushiData = [
  {id:"paws",name:"×¤×•×¡ - 65â‚ª",description:"×¡×œ××•×Ÿ ×¦×¨×•×‘, ××‘×•×§×“×•, ×‘×˜×˜×” ×•×¤× ×§×•",price:65},
  {id:"tail",name:"×˜×™×™×œ - 65â‚ª",description:"×˜×•× ×” × ×, ××‘×•×§×“×• ×•×‘×˜×˜×”",price:65}
];

const saucesData = [
    {id:"soya",name:"×¡×•×™×”"},
    {id:"spicy-mayo",name:"×¡×¤×™×™×¡×™ ××™×•× ×–"},
    {id:"teriyaki",name:"×˜×¨×™××§×™"},
    {id:"ginger-wasabi",name:"×’'×™× ×’'×¨ ×•×•××¡××‘×™"}
];

/* ================== UTILS ================== */
function createRollCard(roll){
    const card=document.createElement('div');
    card.className='roll-card';
    card.innerHTML=`
        <div class="info">
            <h3>${roll.name}</h3>
            <p>${roll.description}</p>
        </div>
        <div class="quantity-control">
            <button class="minus">âˆ’</button>
            <input type="number" readonly value="0" min="0">
            <button class="plus">+</button>
        </div>
    `;
    const minusBtn = card.querySelector('.minus');
    const plusBtn = card.querySelector('.plus');
    const input = card.querySelector('input');
    minusBtn.addEventListener('click',()=>{if(input.value>0){input.value--;updateSelection(roll.id,-1)}})
    plusBtn.addEventListener('click',()=>{input.value++;updateSelection(roll.id,1)});
    return card;
}

function createSauceCheckbox(sauce){
    const div=document.createElement('div');
    div.innerHTML=`<input type="checkbox" id="sauce-${sauce.id}" data-id="${sauce.id}"> <label for="sauce-${sauce.id}">${sauce.name}</label>`;
    return div;
}

function updateSelection(rollId,delta){
    selectedRolls[rollId]=(selectedRolls[rollId]||0)+delta;
    if(selectedRolls[rollId]<=0) delete selectedRolls[rollId];
    updateSummary();
}

function updateSummary(){
    const summary = document.getElementById('order-summary');
    let total=0;
    let text='';
    for(let id in selectedRolls){
        let roll = allRolls.find(r=>r.id===id);
        text+=`${roll.name} x ${selectedRolls[id]} = â‚ª${roll.price*selectedRolls[id]}\n`;
        total+=roll.price*selectedRolls[id];
    }
    const saucesSelected = Object.keys(selectedSauces);
    text+=`\n×¨×•×˜×‘×™×: ${saucesSelected.length? saucesSelected.map(k=>saucesData.find(s=>s.id===k).name).join(', '):'×œ×œ×'}\n`;
    text+=`×›×¤×™×•×ª: ${chopsticksCount}\n`;
    text+=`×”×¢×¨×•×ª: ${document.getElementById('notes').value||'×œ×œ×'}\n`;
    summary.textContent=text+'\n×¡×”"×›: â‚ª'+total;
    document.getElementById('send-order').disabled = !currentUser || !Object.keys(selectedRolls).length;
}

/* ================== INIT ================== */
const allRolls=[...insideOutRollsData,...makiRollsData,...onigiriData,...pokeData,...oshizushiData];
function renderCategory(containerId,rolls){
    const container=document.getElementById(containerId);
    rolls.forEach(roll=>container.appendChild(createRollCard(roll)));
}
renderCategory('insideout-rolls',insideOutRollsData);
renderCategory('maki-rolls',makiRollsData);
renderCategory('onigiri-rolls',onigiriData);
renderCategory('poke-rolls',pokeData);
renderCategory('oshizushi-rolls',oshizushiData);

const saucesContainer = document.getElementById('sauces-container');
saucesData.forEach(sauce=>{
    const el=createSauceCheckbox(sauce);
    saucesContainer.appendChild(el);
    const input=el.querySelector('input');
    input.addEventListener('change',()=>{input.checked? selectedSauces[sauce.id]=true: delete selectedSauces[sauce.id]; updateSummary();})
});

/* Tabs */
document.querySelectorAll('.tab').forEach(tab=>{
    tab.addEventListener('click',()=>{
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.category-container').forEach(c=>c.style.display='none');
        document.getElementById(tab.dataset.target).style.display='flex';
    })
});

/* Chopsticks */
document.getElementById('chopsticks-plus').addEventListener('click',()=>{chopsticksCount++;document.getElementById('chopsticks-qty').value=chopsticksCount; updateSummary();})
document.getElementById('chopsticks-minus').addEventListener('click',()=>{if(chopsticksCount>1){chopsticksCount--;document.getElementById('chopsticks-qty').value=chopsticksCount; updateSummary();}})

/* Pickup time */
const pickupSelect = document.getElementById('pickup-time');
for(let h=19;h<=22;h++){for(let m=0;m<60;m+=30){if(h===22 && m>30)continue; const val=`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;const opt=document.createElement('option');opt.value=val;opt.textContent=val;pickupSelect.appendChild(opt);}}

pickupSelect.addEventListener('change',updateSummary);

/* Notes */
document.getElementById('notes').addEventListener('input',updateSummary);

/* Profile button */
function handleCredentialResponse(response){
    const data = jwt_decode(response.credential);
    currentUser={name:data.name,email:data.email,picture:data.picture};
    localStorage.setItem('currentUser',JSON.stringify(currentUser));
    document.getElementById('profile-btn').textContent='×¤×¨×•×¤×™×œ';
    updateSummary();
}

window.onload = function () {
    google.accounts.id.initialize({client_id:GOOGLE_CLIENT_ID,callback:handleCredentialResponse});
    google.accounts.id.renderButton(document.getElementById('profile-btn'),{theme:"outline",size:"medium"});
}

/* Send order */
document.getElementById('send-order').addEventListener('click',async()=>{
    if(!currentUser){alert('×¢×œ×™×š ×œ×”×ª×—×‘×¨ ×œ×¤× ×™ ×©×œ×™×—×ª ×”×–×× ×”');return;}
    if(!Object.keys(selectedRolls).length){alert('×‘×—×¨ ×œ×¤×—×•×ª ×¨×•×œ ××—×“');return;}
    const orderData={
        user:currentUser,
        rolls:selectedRolls,
        sauces:Object.keys(selectedSauces),
        chopsticks:chopsticksCount,
        notes:document.getElementById('notes').value,
        pickup:pickupSelect.value,
        created_at:new Date().toISOString()
    };
    // Supabase insert
    try{
        if(supabase){
            let {error} = await supabase.from('orders').insert([orderData]);
            if(error)throw error;
        }
        // Make webhook
        await fetch(MAKE_WEBHOOK_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(orderData)});
        alert('×”×”×–×× ×” × ×©×œ×—×” ×‘×”×¦×œ×—×”!');
        selectedRolls={}; selectedSauces={}; chopsticksCount=1;
        document.getElementById('chopsticks-qty').value=1;
        document.getElementById('notes').value='';
        document.querySelectorAll('#menu-area input[type="number"]').forEach(inp=>inp.value=0);
        updateSummary();
    }catch(err){console.error(err);alert('×©×’×™××” ×‘×©×œ×™×—×ª ×”×”×–×× ×”');}
});
updateSummary();
</script>
</body>
</html>
