<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>סושי אונליין</title>
<style>
:root {
  --accent:#7a2a2a;
  --accent-dark:#5e1b1b;
  --bg:#fff;
  --danger:#d9534f;
}

body {
  margin:0;
  font-family: Arial, Helvetica, sans-serif;
  background: linear-gradient(180deg,#f6f5f4, #efecec);
  color:#222;
}

header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px;
}

#logo {
  margin:0 auto;
  max-width:120px;
}

.user-actions {
  display:flex;
  gap:8px;
}

.btn {
  padding:8px 14px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  font-weight:700;
}

.btn.primary { background:var(--accent); color:#fff; }
.btn.secondary { background:#fff; color:var(--accent); border:1px solid #ddd; }

nav.menu-tabs {
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
  margin-top:12px;
}

.tab {
  padding:8px 12px;
  border-radius:8px;
  background:#fff;
  border:1px solid #eee;
  cursor:pointer;
  font-weight:700;
}

.tab.active {
  background:var(--accent);
  color:#fff;
  border-color:var(--accent-dark);
}

main {
  display:flex;
  flex-direction:column;
  padding:12px;
}

.category-container {
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  margin-bottom:12px;
}

.roll-card {
  flex:1 1 200px;
  background:var(--bg);
  border-radius:10px;
  box-shadow:0 4px 14px rgba(0,0,0,0.05);
  padding:12px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}

.quantity-control {
  display:flex;
  align-items:center;
  gap:6px;
  margin-top:6px;
}

.quantity-control button {
  width:32px;
  height:32px;
  border:none;
  border-radius:6px;
  background:#f0c0c0;
  color:var(--accent);
  font-weight:700;
  font-size:1.2rem;
  cursor:pointer;
}

.quantity-control input {
  width:50px;
  text-align:center;
  border:1px solid #ddd;
  border-radius:6px;
  padding:4px;
}

.panel {
  background:#fff;
  padding:12px;
  border-radius:10px;
  box-shadow:0 4px 14px rgba(0,0,0,0.04);
  margin-bottom:12px;
}

.panel-title {
  font-weight:800;
  color:var(--accent);
  margin-bottom:8px;
}

textarea {
  width:100%;
  min-height:80px;
  border:1px solid #ddd;
  border-radius:6px;
  padding:8px;
  font-family:Arial,sans-serif;
  font-size:0.95rem;
}

#order-summary {
  background:#fafafa;
  padding:10px;
  border-radius:8px;
  min-height:120px;
  white-space:pre-wrap;
  font-family:"Courier New", monospace;
}

.note {
  font-size:0.9rem;
  color:#6b6b6b;
  margin-top:6px;
}

/* Responsive */
@media(max-width:980px){
  .roll-card { flex:1 1 100%; }
  nav.menu-tabs { flex-wrap:wrap; justify-content:center; }
}
</style>
</head>
<body>

<header>
  <div class="user-actions">
    <button id="auth-btn" class="btn primary">התחבר</button>
    <button id="profile-btn" class="btn secondary" style="display:none;">פרופיל</button>
  </div>
  <img id="logo" src="YOUR_LOGO_URL_HERE" alt="לוגו">
</header>

<nav class="menu-tabs">
  <button class="tab active" data-target="insideout-rolls">Inside-Out</button>
  <button class="tab" data-target="maki-rolls">Maki</button>
  <button class="tab" data-target="onigiri-rolls">Onigiri</button>
  <button class="tab" data-target="poke-rolls">Poke</button>
  <button class="tab" data-target="oshizushi-rolls">Oshizushi</button>
</nav>

<main>
  <section id="insideout-rolls" class="category-container"></section>
  <section id="maki-rolls" class="category-container" style="display:none;"></section>
  <section id="onigiri-rolls" class="category-container" style="display:none;"></section>
  <section id="poke-rolls" class="category-container" style="display:none;"></section>
  <section id="oshizushi-rolls" class="category-container" style="display:none;"></section>

  <section class="panel">
    <div class="panel-title">רטבים</div>
    <div id="sauces-container" class="category-container"></div>
    <p class="note">כל רול מקבל 2 רטבים חינם. רוטב נוסף 3₪.</p>
  </section>

  <section class="panel">
    <div class="panel-title">כמות צ'ופסטיקס</div>
    <div class="quantity-control">
      <button id="chopsticks-minus">−</button>
      <input id="chopsticks-qty" type="number" readonly value="1">
      <button id="chopsticks-plus">+</button>
    </div>
  </section>

  <section class="panel">
    <div class="panel-title">הערות אישיות</div>
    <textarea id="notes" placeholder="לדוגמה: ללא גלוטן, הגעה בשער 3..."></textarea>
  </section>

  <section class="panel">
    <div class="panel-title">סיכום הזמנה</div>
    <pre id="order-summary">הזמנה ריקה — בחר רולים והערות להצגת הסיכום.</pre>
    <button id="send-order" class="btn primary">שלח הזמנה</button>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>

<script>
// ============ CONFIG =============
const SUPABASE_URL='YOUR_SUPABASE_URL';
const SUPABASE_KEY='YOUR_SUPABASE_KEY';
const supabase = supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
const MAKE_WEBHOOK_URL='YOUR_MAKE_WEBHOOK_URL';
const GOOGLE_CLIENT_ID='YOUR_GOOGLE_CLIENT_ID';

// ============ STORAGE / STATE ============
let currentUser=null;
let chopsticksCount=1;
let selectedRolls={};
let selectedSauces={};

// ============ DATA ============
const insideOutRollsData=[ /* מלא את כל הרולים שלך */ ];
const makiRollsData=[ /* מלא את כל הרולים שלך */ ];
const onigiriData=[ /* מלא את כל הרולים שלך */ ];
const pokeData=[ /* מלא את כל הרולים שלך */ ];
const oshizushiData=[ /* מלא את כל הרולים שלך */ ];

const saucesData=[
  {id:'spicy-mayo', name:'ספייסי מיונז', price:3},
  {id:'soy', name:'סויה', price:3},
  {id:'teriyaki', name:'טריאקי', price:3},
  {id:'ginger', name:'ג׳ינג׳ר', price:3},
  {id:'wasabi', name:'וואסאבי', price:3}
];

// ============ HELPERS ============
function $id(id){return document.getElementById(id);}
function showMessage(txt,isError=true){alert(txt);}

// ============ RENDER MENU ============
function createRollCard(item,containerId){
  const container=$id(containerId);
  const card=document.createElement('div');
  card.className='roll-card';
  card.dataset.id=item.id;
  card.innerHTML=`<h3>${item.name}</h3><p>${item.description}</p>`;
  const controls=document.createElement('div'); controls.className='quantity-control';
  const btnMinus=document.createElement('button'); btnMinus.textContent='−';
  const inputQty=document.createElement('input'); inputQty.type='number'; inputQty.readOnly=true; inputQty.value=selectedRolls[item.id]||0;
  const btnPlus=document.createElement('button'); btnPlus.textContent='+';

  btnPlus.addEventListener('click',()=>{selectedRolls[item.id]=(selectedRolls[item.id]||0)+1; inputQty.value=selectedRolls[item.id]; updateSummary();});
  btnMinus.addEventListener('click',()=>{if((selectedRolls[item.id]||0)>0){selectedRolls[item.id]--; inputQty.value=selectedRolls[item.id]; updateSummary();}});
  controls.append(btnMinus,inputQty,btnPlus); card.appendChild(controls); container.appendChild(card);
}

function createSauceCard(item){
  const container=$id('sauces-container');
  const card=document.createElement('div');
  card.className='roll-card';
  card.dataset.id=item.id;
  card.innerHTML=`<h3>${item.name}</h3>`;
  const controls=document.createElement('div'); controls.className='quantity-control';
  const btnMinus=document.createElement('button'); btnMinus.textContent='−';
  const inputQty=document.createElement('input'); inputQty.type='number'; inputQty.readOnly=true; inputQty.value=selectedSauces[item.id]||0;
  const btnPlus=document.createElement('button'); btnPlus.textContent='+';
  btnPlus.addEventListener('click',()=>{selectedSauces[item.id]=(selectedSauces[item.id]||0)+1; inputQty.value=selectedSauces[item.id]; updateSummary();});
  btnMinus.addEventListener('click',()=>{if((selectedSauces[item.id]||0)>0){selectedSauces[item.id]--; inputQty.value=selectedSauces[item.id]; updateSummary();}});
  controls.append(btnMinus,inputQty,btnPlus); card.appendChild(controls); container.appendChild(card);
}

function renderMenu(){
  ['insideout-rolls','maki-rolls','onigiri-rolls','poke-rolls','oshizushi-rolls'].forEach(id=>{
    const arr={insideout-rolls:insideOutRollsData,maki-rolls:makiRollsData,onigiri-rolls:onigiriData,poke-rolls:pokeData,oshizushi-rolls:oshizushiData}[id];
    arr.forEach(r=>createRollCard(r,id));
  });
  saucesData.forEach(s=>createSauceCard(s));
}

// ============ SUMMARY ============
function updateSummary(){
  let text=""; let total=0;
  for(const [id,qty] of Object.entries(selectedRolls)){
    if(qty>0){
      const item=[...insideOutRollsData,...makiRollsData,...onigiriData,...pokeData,...oshizushiData].find(x=>x.id===id);
      text+=`${item.name} x${qty} — ₪${item.price*qty}\n`;
      total+=item.price*qty;
    }
  }
  text+="\nרטבים:\n";
  for(const id in selectedSauces){if(selectedSauces[id]){ const s=saucesData.find(x=>x.id===id); text+=`${s.name} x${selectedSauces[id]}\n`; }}
  text+=`\nכמות צ'ופסטיקס: ${chopsticksCount}\n`;
  text+=`\nהערות: ${$id('notes').value}\n`;
  text+=`\nסה"כ: ₪${total}`;
  $id('order-summary').textContent=text;
}

// ============ CHOPSTICKS ============
$id('chopsticks-plus').addEventListener('click',()=>{chopsticksCount++; $id('chopsticks-qty').value=chopsticksCount; updateSummary();});
$id('chopsticks-minus').addEventListener('click',()=>{if(chopsticksCount>1){chopsticksCount--; $id('chopsticks-qty').value=chopsticksCount; updateSummary();}});

// ============ TABS ============
document.querySelectorAll('.tab').forEach(tab=>{
  tab.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    document.querySelectorAll('.category-container').forEach(c=>c.style.display='none');
    $id(tab.dataset.target).style.display='flex';
  });
});

// ============ AUTH ============
function handleCredentialResponse(response){
  const decoded=jwt_decode(response.credential);
  currentUser={name:decoded.name,email:decoded.email};
  $id('auth-btn').style.display='none';
  $id('profile-btn').style.display='inline-block';
}
$id('auth-btn').addEventListener('click',()=>{
  google.accounts.id.initialize({client_id:GOOGLE_CLIENT_ID,callback:handleCredentialResponse});
  google.accounts.id.prompt();
});

// ============ SEND ORDER ============
$id('send-order').addEventListener('click',async()=>{
  if(!currentUser){showMessage("עליך להתחבר לפני שליחת ההזמנה!"); return;}
  if(Object.values(selectedRolls).every(q=>q===0)){showMessage("בחר לפחות רול אחד!"); return;}
  const order={
    uuid:crypto.randomUUID(),
    timestamp:new Date().toISOString(),
    user:currentUser,
    rolls:selectedRolls,
    sauces:selectedSauces,
    chopsticks:chopsticksCount,
    notes:$id('notes').value
  };
  const {error}=await supabase.from('Sushi').insert([{Id:order.uuid,created_at:order.timestamp,User_name:currentUser.name,User_email:currentUser.email,Rolls:order.rolls,sauces:order.sauces,chopsticks_count:chopsticksCount,Notes:order.notes}]);
  if(error){showMessage("שגיאה בשליחת ההזמנה ל-DB"); return;}
  await fetch(MAKE_WEBHOOK_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(order)});
  showMessage("ההזמנה נשלחה בהצלחה!",false);
  selectedRolls={}; selectedSauces={}; chopsticksCount=1; $id('notes').value=''; updateSummary();
});

window.addEventListener('load',()=>{
  renderMenu();
  updateSummary();
});
</script>

</body>
</html>
